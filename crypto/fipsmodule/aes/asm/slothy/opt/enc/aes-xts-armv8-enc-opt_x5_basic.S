// The following xts encrypt is from MacBook M3 build folder
// after moving around some instructions

#if !defined(__has_feature)
#define __has_feature(x) 0
#endif
#if __has_feature(memory_sanitizer) && !defined(OPENSSL_NO_ASM)
#define OPENSSL_NO_ASM
#endif

#include <openssl/asm_base.h>

#if !defined(OPENSSL_NO_ASM) && defined(__AARCH64EL__)
#if defined(__ELF__)
#include <openssl/boringssl_prefix_symbols_asm.h>
#include <openssl/arm_arch.h>
.arch   armv8-a+crypto
.text
.globl  aes_hw_slothy_xts_encrypt
.hidden aes_hw_slothy_xts_encrypt
.type   aes_hw_slothy_xts_encrypt,%function
#elif defined(__APPLE__)
#if defined(BORINGSSL_PREFIX)
#include <boringssl_prefix_symbols_asm.h>
#endif
#include <openssl/arm_arch.h>
.text
.globl	_aes_hw_slothy_xts_encrypt
.private_extern	_aes_hw_slothy_xts_encrypt
#else
#error Unknown configuration
#endif

#if __ARM_MAX_ARCH__ >= 8

.align	4


#define STACK_BASE_VREGS 0
#define STACK_SIZE_VREGS (4*16)

.macro save_vregs
        stp  d8,  d9, [sp, #(STACK_BASE_VREGS + 16*0)]
        stp d10, d11, [sp, #(STACK_BASE_VREGS + 16*1)]
        stp d12, d13, [sp, #(STACK_BASE_VREGS + 16*2)]
        stp d14, d15, [sp, #(STACK_BASE_VREGS + 16*3)]
.endm

.macro restore_vregs
        ldp  d8,  d9, [sp, #(STACK_BASE_VREGS + 16*0)]
        ldp d10, d11, [sp, #(STACK_BASE_VREGS + 16*1)]
        ldp d12, d13, [sp, #(STACK_BASE_VREGS + 16*2)]
        ldp d14, d15, [sp, #(STACK_BASE_VREGS + 16*3)]
.endm

// A single AES round
// Prevent SLOTHY from unfolding because uArchs tend to fuse AESMC+AESE
.macro aesr data, key // @slothy:no-unfold
        aese  \data, \key
        aesmc \data, \data
.endm

_aes_hw_slothy_xts_encrypt:
aes_hw_slothy_xts_encrypt:
 # AARCH64_VALID_CALL_TARGET

    sub sp, sp, #STACK_SIZE_VREGS
    save_vregs

 cmp	x2,#16
    // Original input data size bigger than 16, jump to big size processing.
 b.ne	Lxts_enc_big_size
    // Encrypt the iv with key2, as the first XEX iv.
 ldr	w6,[x4,#240]
 ld1	{v0.16b},[x4],#16
 ld1	{v6.16b},[x5]
 sub	w6,w6,#2
 ld1	{v1.16b},[x4],#16

Loop_enc_iv_enc:
 aese	v6.16b,v0.16b
 aesmc	v6.16b,v6.16b
 ld1	{v0.4s},[x4],#16
 aese	v6.16b,v1.16b
 aesmc	v6.16b,v6.16b
 ld1	{v1.4s},[x4],#16
 subs	w6,w6,#2
 cbnz	w6,Loop_enc_iv_enc

 aese	v6.16b,v0.16b
 aesmc	v6.16b,v6.16b
 ld1	{v0.4s},[x4]
 aese	v6.16b,v1.16b
 eor	v6.16b,v6.16b,v0.16b

 ld1	{v0.16b},[x0]
 eor	v0.16b,v6.16b,v0.16b

 ldr	w6,[x3,#240]
 ld1	{v28.4s,v29.4s},[x3],#32       // load key schedule...

 aese	v0.16b,v28.16b
 aesmc	v0.16b,v0.16b
 ld1	{v16.4s,v17.4s},[x3],#32         // load key schedule...
 aese	v0.16b,v29.16b
 aesmc	v0.16b,v0.16b
 subs	w6,w6,#10     // if rounds==10, jump to aes-128-xts processing
// b.eq    .Lxts_128_enc
Lxts_enc_round_loop:
 aese	v0.16b,v16.16b
 aesmc	v0.16b,v0.16b
 ld1	{v16.4s},[x3],#16            // load key schedule...
 aese	v0.16b,v17.16b
 aesmc	v0.16b,v0.16b
 ld1	{v17.4s},[x3],#16            // load key schedule...
 subs	w6,w6,#2          // bias
 b.gt	Lxts_enc_round_loop
// .Lxts_128_enc:
 ld1	{v18.4s,v19.4s},[x3],#32       // load key schedule...
 aese	v0.16b,v16.16b
 aesmc	v0.16b,v0.16b
 aese	v0.16b,v17.16b
 aesmc	v0.16b,v0.16b
 ld1	{v20.4s,v21.4s},[x3],#32       // load key schedule...
 aese	v0.16b,v18.16b
 aesmc	v0.16b,v0.16b
 aese	v0.16b,v19.16b
 aesmc	v0.16b,v0.16b
 ld1	{v22.4s,v23.4s},[x3],#32       // load key schedule...
 aese	v0.16b,v20.16b
 aesmc	v0.16b,v0.16b
 aese	v0.16b,v21.16b
 aesmc	v0.16b,v0.16b
 ld1	{v7.4s},[x3]
 aese	v0.16b,v22.16b
 aesmc	v0.16b,v0.16b
 aese	v0.16b,v23.16b
 eor	v0.16b,v0.16b,v7.16b
 eor	v0.16b,v0.16b,v6.16b
 st1	{v0.16b},[x1]
 b	Lxts_enc_final_abort

.align	4
Lxts_enc_big_size:
   // Encrypt input size > 16 bytes
 stp	x19,x20,[sp,#-32]!
 stp	x21,x22,[sp,#16]

    // tailcnt store the tail value of length%16.
 and	x21,x2,#0xf
 and	x2,x2,#-16    // len &= 0x1..110000, now divisible by 16
 subs	x2,x2,#16
 mov	x8,#16
 b.lo	Lxts_abort         // if !(len > 16): error
 csel	x8,xzr,x8,eq  // if (len == 16): step = 0

    // Firstly, encrypt the iv with key2, as the first iv of XEX.
 ldr	w6,[x4,#240]
 ld1	{v0.4s},[x4],#16
 ld1	{v6.16b},[x5]
 sub	w6,w6,#2
 ld1	{v1.4s},[x4],#16

Loop_iv_enc:
 aese	v6.16b,v0.16b
 aesmc	v6.16b,v6.16b
 ld1	{v0.4s},[x4],#16
 subs	w6,w6,#2
 aese	v6.16b,v1.16b
 aesmc	v6.16b,v6.16b
 ld1	{v1.4s},[x4],#16
 b.gt	Loop_iv_enc

 aese	v6.16b,v0.16b
 aesmc	v6.16b,v6.16b
 ld1	{v0.4s},[x4]
 aese	v6.16b,v1.16b
 eor	v6.16b,v6.16b,v0.16b

    // The iv for second block
    // x9- iv(low), x10 - iv(high)
    // the five ivs stored into, v6.16b,v8.16b,v9.16b,v10.16b,v11.16b
 fmov	x9,d6
 fmov	x10,v6.d[1]
 mov	w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d8,x9
 fmov	v8.d[1],x10

 ldr	w5,[x3,#240]       // next starting point
 ld1	{v0.16b},[x0],x8

    mov x7, x3
 ld1	{v16.4s,v17.4s},[x7], #32         // load key schedule...
    ld1 {v12.4s,v13.4s},[x7], #32
 ld1	{v14.4s,v15.4s},[x7], #32
    ld1 {v4.4s,v5.4s},  [x7], #32
    ld1	{v18.4s,v19.4s},[x7], #32
 ld1	{v20.4s,v21.4s},[x7], #32
 ld1	{v22.4s,v23.4s},[x7], #32
 ld1	{v7.4s},        [x7]

 sub	w5,w5,#8
 add	x7,x3,#32
 mov	w6,w5

    // Encryption
Lxts_enc:
 ld1	{v24.16b},[x0],#16
 subs	x2,x2,#32           // bias
 add	w6,w5,#2
 orr	v28.16b,v0.16b,v0.16b
 orr	v29.16b,v24.16b,v24.16b
 b.lo	Lxts_inner_enc_tail    // when input size % 5 = 1 or 2
                                    // (with tail or not)
 eor	v0.16b,v0.16b,v6.16b          // before encryption, xor with iv
 eor	v24.16b,v24.16b,v8.16b

    // The iv for third block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d9,x9
 fmov	v9.d[1],x10


 orr	v1.16b,v24.16b,v24.16b
 ld1	{v24.16b},[x0],#16
 orr	v2.16b,v0.16b,v0.16b
 orr	v3.16b,v1.16b,v1.16b
 eor	v27.16b,v24.16b,v9.16b         // the third block
 eor	v24.16b,v24.16b,v9.16b
 cmp	x2,#32
 b.lo	Lxts_outer_enc_tail

    // The iv for fourth block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d10,x9
 fmov	v10.d[1],x10

 ld1	{v25.16b},[x0],#16
    // The iv for fifth block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d11,x9
 fmov	v11.d[1],x10

 ld1	{v26.16b},[x0],#16
 eor	v25.16b,v25.16b,v10.16b        // the fourth block
 eor	v26.16b,v26.16b,v11.16b
 sub	x2,x2,#32           // bias
 mov	w6,w5

.align	4
                                             // Instructions:    154
                                             // Expected cycles: 63
                                             // Expected IPC:    2.44
                                             //
                                             // Cycle bound:     63.0
                                             // IPC bound:       2.44
                                             //
                                             // Wall time:     2.37s
                                             // User time:     2.37s
                                             //
                                             // ---------------------- cycle (expected) ---------------------->
                                             // 0                        25                       50
                                             // |------------------------|------------------------|------------
        aese v26.16b, v16.16b                // *..............................................................
        aese v25.16b, v16.16b                // *..............................................................
        aese v0.16b, v16.16b                 // *..............................................................
        aese v1.16b, v16.16b                 // *..............................................................
        extr x22, x10, x10, #32              // *..............................................................
        extr x5, x10, x9, #63                // *..............................................................
        aese v24.16b, v16.16b                // .*.............................................................
        and w10, w19, w22, asr #31           // .*.............................................................
        subs x4, x2, #0x50                   // .*.............................................................
        extr x22, x5, x5, #32                // .*.............................................................
        eor x3, x10, x9, lsl #1              // ..*............................................................
        aesmc v28.16b, v26.16b               // ..*............................................................
        aesmc v31.16b, v0.16b                // ..*............................................................
        aesmc v0.16b, v1.16b                 // ..*............................................................
        csel x17, xzr, x4, gt                // ..*............................................................
        and w16, w19, w22, asr #31           // ..*............................................................
        add x0, x0, x17                      // ...*...........................................................
        aesmc v3.16b, v25.16b                // ...*...........................................................
        aesmc v1.16b, v24.16b                // ...*...........................................................
        eor x14, x16, x3, lsl #1             // ...*...........................................................
        extr x4, x5, x3, #63                 // ...*...........................................................
        aese v28.16b, v17.16b                // ....*..........................................................
        aese v31.16b, v17.16b                // ....*..........................................................
        aese v0.16b, v17.16b                 // ....*..........................................................
        ldp q29, q2, [x0, #48]               // ....*..........................................................
        extr x22, x4, x4, #32                // ....*..........................................................
        extr x17, x4, x14, #63               // ....*..........................................................
        aese v3.16b, v17.16b                 // .....*.........................................................
        aese v1.16b, v17.16b                 // .....*.........................................................
        and w9, w19, w22, asr #31            // .....*.........................................................
        ldp q25, q30, [x0], #0x50            // .....*.........................................................
        extr x22, x17, x17, #32              // .....*.........................................................
        aesmc v26.16b, v28.16b               // ......*........................................................
        aesmc v28.16b, v31.16b               // ......*........................................................
        aesmc v27.16b, v0.16b                // ......*........................................................
        eor x15, x9, x14, lsl #1             // ......*........................................................
        and w12, w19, w22, asr #31           // ......*........................................................
        aesmc v24.16b, v3.16b                // .......*.......................................................
        aesmc v1.16b, v1.16b                 // .......*.......................................................
        eor x8, x12, x15, lsl #1             // .......*.......................................................
        extr x12, x17, x15, #63              // .......*.......................................................
        aese v26.16b, v12.16b                // ........*......................................................
        aese v28.16b, v12.16b                // ........*......................................................
        aese v27.16b, v12.16b                // ........*......................................................
        extr x22, x12, x12, #32              // ........*......................................................
        extr x10, x12, x8, #63               // ........*......................................................
        aese v24.16b, v12.16b                // .........*.....................................................
        aese v1.16b, v12.16b                 // .........*.....................................................
        and w16, w19, w22, asr #31           // .........*.....................................................
        aesmc v3.16b, v26.16b                // ..........*....................................................
        aesmc v28.16b, v28.16b               // ..........*....................................................
        aesmc v0.16b, v27.16b                // ..........*....................................................
        eor x9, x16, x8, lsl #1              // ..........*....................................................
        aesmc v24.16b, v24.16b               // ...........*...................................................
        aesmc v1.16b, v1.16b                 // ...........*...................................................
        aese v3.16b, v13.16b                 // ............*..................................................
        aese v28.16b, v13.16b                // ............*..................................................
        aese v0.16b, v13.16b                 // ............*..................................................
        aese v24.16b, v13.16b                // .............*.................................................
        aese v1.16b, v13.16b                 // .............*.................................................
        aesmc v3.16b, v3.16b                 // ..............*................................................
        aesmc v28.16b, v28.16b               // ..............*................................................
        aesmc v0.16b, v0.16b                 // ..............*................................................
        aesmc v27.16b, v1.16b                // ...............*...............................................
        aese v3.16b, v14.16b                 // ................*..............................................
        aese v28.16b, v14.16b                // ................*..............................................
        aese v0.16b, v14.16b                 // ................*..............................................
        aese v27.16b, v14.16b                // .................*.............................................
        aesmc v26.16b, v3.16b                // ..................*............................................
        aesmc v28.16b, v28.16b               // ..................*............................................
        aesmc v1.16b, v0.16b                 // ..................*............................................
        aesmc v31.16b, v27.16b               // ...................*...........................................
        aese v26.16b, v15.16b                // ....................*..........................................
        aese v28.16b, v15.16b                // ....................*..........................................
        aese v1.16b, v15.16b                 // ....................*..........................................
        aese v31.16b, v15.16b                // .....................*.........................................
        aesmc v26.16b, v26.16b               // ......................*........................................
        aesmc v3.16b, v28.16b                // ......................*........................................
        aesmc v27.16b, v1.16b                // ......................*........................................
        aesmc v31.16b, v31.16b               // .......................*.......................................
        aese v26.16b, v4.16b                 // ........................*......................................
        aese v3.16b, v4.16b                  // ........................*......................................
        aese v27.16b, v4.16b                 // ........................*......................................
        aese v31.16b, v4.16b                 // .........................*.....................................
        aesmc v1.16b, v26.16b                // ..........................*....................................
        aesmc v28.16b, v3.16b                // ..........................*....................................
        aesmc v3.16b, v27.16b                // ..........................*....................................
        aesmc v0.16b, v31.16b                // ...........................*...................................
        aese v1.16b, v5.16b                  // ............................*..................................
        aese v28.16b, v5.16b                 // ............................*..................................
        aese v3.16b, v5.16b                  // ............................*..................................
        aese v0.16b, v5.16b                  // .............................*.................................
        aesmc v26.16b, v1.16b                // ..............................*................................
        aesmc v31.16b, v28.16b               // ..............................*................................
        aesmc v3.16b, v3.16b                 // ..............................*................................
        aesmc v1.16b, v0.16b                 // ...............................*...............................
        aese v26.16b, v18.16b                // ................................*..............................
        aese v31.16b, v18.16b                // ................................*..............................
        aese v3.16b, v18.16b                 // ................................*..............................
        aese v1.16b, v18.16b                 // .................................*.............................
        aesmc v0.16b, v26.16b                // ..................................*............................
        aesmc v28.16b, v31.16b               // ..................................*............................
        aesmc v3.16b, v3.16b                 // ..................................*............................
        aesmc v27.16b, v1.16b                // ...................................*...........................
        aese v0.16b, v19.16b                 // ....................................*..........................
        aese v28.16b, v19.16b                // ....................................*..........................
        aese v3.16b, v19.16b                 // ....................................*..........................
        aese v27.16b, v19.16b                // .....................................*.........................
        aesmc v0.16b, v0.16b                 // ......................................*........................
        aesmc v1.16b, v28.16b                // ......................................*........................
        aesmc v3.16b, v3.16b                 // ......................................*........................
        aesmc v26.16b, v27.16b               // .......................................*.......................
        aese v0.16b, v20.16b                 // ........................................*......................
        aese v1.16b, v20.16b                 // ........................................*......................
        aese v3.16b, v20.16b                 // ........................................*......................
        aese v26.16b, v20.16b                // .........................................*.....................
        aesmc v27.16b, v0.16b                // ..........................................*....................
        aesmc v1.16b, v1.16b                 // ..........................................*....................
        aesmc v28.16b, v3.16b                // ..........................................*....................
        aesmc v0.16b, v26.16b                // ...........................................*...................
        aese v27.16b, v21.16b                // ............................................*..................
        aese v1.16b, v21.16b                 // ............................................*..................
        aese v28.16b, v21.16b                // ............................................*..................
        aese v0.16b, v21.16b                 // .............................................*.................
        aesmc v26.16b, v27.16b               // ..............................................*................
        aesmc v31.16b, v1.16b                // ..............................................*................
        aesmc v1.16b, v28.16b                // ..............................................*................
        aesmc v0.16b, v0.16b                 // ...............................................*...............
        aese v26.16b, v22.16b                // ................................................*..............
        aese v31.16b, v22.16b                // ................................................*..............
        aese v1.16b, v22.16b                 // ................................................*..............
        aese v0.16b, v22.16b                 // .................................................*.............
        aesmc v26.16b, v26.16b               // ..................................................*............
        aesmc v3.16b, v31.16b                // ..................................................*............
        aesmc v27.16b, v1.16b                // ..................................................*............
        aesmc v1.16b, v0.16b                 // ...................................................*...........
        aese v26.16b, v23.16b                // ....................................................*..........
        aese v3.16b, v23.16b                 // ....................................................*..........
        aese v27.16b, v23.16b                // ....................................................*..........
        aese v1.16b, v23.16b                 // .....................................................*.........
        eor v31.16B, v26.16B, v7.16B         // ......................................................*........
        eor v26.16B, v3.16B, v7.16B          // ......................................................*........
        eor v27.16B, v27.16B, v7.16B         // ......................................................*........
        eor v28.16B, v31.16B, v11.16B        // ........................................................*......
        eor v3.16B, v26.16B, v6.16B          // ........................................................*......
        fmov d6, x3                          // ........................................................*......
        fmov d11, x9                         // ........................................................*......
        eor v27.16B, v27.16B, v8.16B         // .........................................................*.....
        fmov d8, x14                         // ..........................................................*....
        fmov v6.d[1], x5                     // ...........................................................*...
        fmov v11.d[1], x10                   // ...........................................................*...
        fmov v8.d[1], x4                     // .............................................................*.
        eor v26.16B, v2.16B, v11.16B         // ..............................................................*
        eor v0.16B, v25.16B, v6.16B          // ..............................................................*

                                                            // ---------------------- cycle (expected) ---------------------->
                                                            // 0                        25                       50
                                                            // |------------------------|------------------------|------------
        // aese v26.16b, v16.16b                            // *..............................................................
        // extr X<ssa_2>, x10, x9, #63                      // *..............................................................
        // extr x22, x10, x10, #32                          // *..............................................................
        // and W<ssa_3>, w19, w22, asr #31                  // .*.............................................................
        // aese v0.16b, v16.16b                             // *..............................................................
        // subs X<ssa_6>, x2, #0x50                         // .*.............................................................
        // extr x22, X<ssa_2>, X<ssa_2>, #32                // .*.............................................................
        // aese v1.16b, v16.16b                             // *..............................................................
        // aesmc V<ssa_9>.16b, v26.16b                      // ..*............................................................
        // eor X<ssa_10>, X<ssa_3>, x9, lsl #1              // ..*............................................................
        // csel X<ssa_11>, xzr, X<ssa_6>, gt                // ..*............................................................
        // aesmc V<ssa_12>.16b, v0.16b                      // ..*............................................................
        // and W<ssa_13>, w19, w22, asr #31                 // ..*............................................................
        // add x0, x0, X<ssa_11>                            // ...*...........................................................
        // extr X<ssa_14>, X<ssa_2>, X<ssa_10>, #63         // ...*...........................................................
        // ldp Q<ssa_15>, q30, [x0], #0x50                  // .....*.........................................................
        // aese V<ssa_9>.16b, v17.16b                       // ....*..........................................................
        // aesmc V<ssa_16>.16b, v1.16b                      // ..*............................................................
        // eor X<ssa_17>, X<ssa_13>, X<ssa_10>, lsl #1      // ...*...........................................................
        // extr x22, X<ssa_14>, X<ssa_14>, #32              // ....*..........................................................
        // aese V<ssa_12>.16b, v17.16b                      // ....*..........................................................
        // extr x17, X<ssa_14>, X<ssa_17>, #63              // ....*..........................................................
        // aese V<ssa_16>.16b, v17.16b                      // ....*..........................................................
        // aesmc V<ssa_19>.16b, V<ssa_9>.16b                // ......*........................................................
        // and W<ssa_20>, w19, w22, asr #31                 // .....*.........................................................
        // extr x22, x17, x17, #32                          // .....*.........................................................
        // and W<ssa_21>, w19, w22, asr #31                 // ......*........................................................
        // aesmc V<ssa_22>.16b, V<ssa_12>.16b               // ......*........................................................
        // eor x15, X<ssa_20>, X<ssa_17>, lsl #1            // ......*........................................................
        // aesmc V<ssa_24>.16b, V<ssa_16>.16b               // ......*........................................................
        // aese V<ssa_19>.16b, v12.16b                      // ........*......................................................
        // aese V<ssa_22>.16b, v12.16b                      // ........*......................................................
        // aese v24.16b, v16.16b                            // .*.............................................................
        // aese V<ssa_24>.16b, v12.16b                      // ........*......................................................
        // aesmc V<ssa_26>.16b, V<ssa_19>.16b               // ..........*....................................................
        // aesmc V<ssa_27>.16b, V<ssa_22>.16b               // ..........*....................................................
        // aesmc V<ssa_28>.16b, v24.16b                     // ...*...........................................................
        // aesmc V<ssa_29>.16b, V<ssa_24>.16b               // ..........*....................................................
        // aese V<ssa_26>.16b, v13.16b                      // ............*..................................................
        // aese V<ssa_27>.16b, v13.16b                      // ............*..................................................
        // aese V<ssa_28>.16b, v17.16b                      // .....*.........................................................
        // aese V<ssa_29>.16b, v13.16b                      // ............*..................................................
        // aesmc V<ssa_31>.16b, V<ssa_26>.16b               // ..............*................................................
        // aesmc V<ssa_32>.16b, V<ssa_27>.16b               // ..............*................................................
        // aesmc V<ssa_33>.16b, V<ssa_28>.16b               // .......*.......................................................
        // aesmc V<ssa_34>.16b, V<ssa_29>.16b               // ..............*................................................
        // aese V<ssa_31>.16b, v14.16b                      // ................*..............................................
        // aese V<ssa_32>.16b, v14.16b                      // ................*..............................................
        // aese V<ssa_33>.16b, v12.16b                      // .........*.....................................................
        // aese V<ssa_34>.16b, v14.16b                      // ................*..............................................
        // aesmc V<ssa_36>.16b, V<ssa_31>.16b               // ..................*............................................
        // aesmc V<ssa_37>.16b, V<ssa_32>.16b               // ..................*............................................
        // aesmc V<ssa_38>.16b, V<ssa_34>.16b               // ..................*............................................
        // aesmc V<ssa_39>.16b, V<ssa_33>.16b               // ...........*...................................................
        // aese V<ssa_36>.16b, v15.16b                      // ....................*..........................................
        // aese V<ssa_37>.16b, v15.16b                      // ....................*..........................................
        // aese V<ssa_38>.16b, v15.16b                      // ....................*..........................................
        // aese V<ssa_39>.16b, v13.16b                      // .............*.................................................
        // aesmc V<ssa_41>.16b, V<ssa_36>.16b               // ......................*........................................
        // aesmc V<ssa_42>.16b, V<ssa_37>.16b               // ......................*........................................
        // aese V<ssa_41>.16b, v4.16b                       // ........................*......................................
        // aesmc V<ssa_43>.16b, V<ssa_39>.16b               // ...............*...............................................
        // aesmc V<ssa_44>.16b, V<ssa_38>.16b               // ......................*........................................
        // aese V<ssa_42>.16b, v4.16b                       // ........................*......................................
        // aese V<ssa_43>.16b, v14.16b                      // .................*.............................................
        // aese V<ssa_44>.16b, v4.16b                       // ........................*......................................
        // aesmc V<ssa_46>.16b, V<ssa_41>.16b               // ..........................*....................................
        // aesmc V<ssa_47>.16b, V<ssa_42>.16b               // ..........................*....................................
        // aesmc V<ssa_48>.16b, V<ssa_44>.16b               // ..........................*....................................
        // aese V<ssa_46>.16b, v5.16b                       // ............................*..................................
        // aesmc V<ssa_49>.16b, V<ssa_43>.16b               // ...................*...........................................
        // aese V<ssa_47>.16b, v5.16b                       // ............................*..................................
        // aese V<ssa_48>.16b, v5.16b                       // ............................*..................................
        // aese V<ssa_49>.16b, v15.16b                      // .....................*.........................................
        // aesmc V<ssa_51>.16b, V<ssa_46>.16b               // ..............................*................................
        // aesmc V<ssa_52>.16b, V<ssa_47>.16b               // ..............................*................................
        // aese V<ssa_51>.16b, v18.16b                      // ................................*..............................
        // aesmc V<ssa_53>.16b, V<ssa_48>.16b               // ..............................*................................
        // aesmc V<ssa_54>.16b, V<ssa_49>.16b               // .......................*.......................................
        // aese V<ssa_52>.16b, v18.16b                      // ................................*..............................
        // aesmc V<ssa_56>.16b, V<ssa_51>.16b               // ..................................*............................
        // aese V<ssa_53>.16b, v18.16b                      // ................................*..............................
        // aese V<ssa_54>.16b, v4.16b                       // .........................*.....................................
        // aesmc V<ssa_57>.16b, V<ssa_52>.16b               // ..................................*............................
        // aese V<ssa_56>.16b, v19.16b                      // ....................................*..........................
        // aesmc V<ssa_58>.16b, V<ssa_54>.16b               // ...........................*...................................
        // aesmc V<ssa_59>.16b, V<ssa_53>.16b               // ..................................*............................
        // aese V<ssa_57>.16b, v19.16b                      // ....................................*..........................
        // aesmc V<ssa_61>.16b, V<ssa_56>.16b               // ......................................*........................
        // aese V<ssa_58>.16b, v5.16b                       // .............................*.................................
        // aese V<ssa_59>.16b, v19.16b                      // ....................................*..........................
        // aesmc V<ssa_62>.16b, V<ssa_57>.16b               // ......................................*........................
        // aese V<ssa_61>.16b, v20.16b                      // ........................................*......................
        // aesmc V<ssa_63>.16b, V<ssa_58>.16b               // ...............................*...............................
        // aesmc V<ssa_64>.16b, V<ssa_59>.16b               // ......................................*........................
        // aese V<ssa_62>.16b, v20.16b                      // ........................................*......................
        // aesmc V<ssa_66>.16b, V<ssa_61>.16b               // ..........................................*....................
        // aese V<ssa_63>.16b, v18.16b                      // .................................*.............................
        // aese V<ssa_64>.16b, v20.16b                      // ........................................*......................
        // eor x8, X<ssa_21>, x15, lsl #1                   // .......*.......................................................
        // aesmc V<ssa_68>.16b, V<ssa_62>.16b               // ..........................................*....................
        // aese V<ssa_66>.16b, v21.16b                      // ............................................*..................
        // aesmc V<ssa_69>.16b, V<ssa_63>.16b               // ...................................*...........................
        // aesmc V<ssa_70>.16b, V<ssa_64>.16b               // ..........................................*....................
        // aese V<ssa_68>.16b, v21.16b                      // ............................................*..................
        // aesmc V<ssa_71>.16b, V<ssa_66>.16b               // ..............................................*................
        // aese V<ssa_69>.16b, v19.16b                      // .....................................*.........................
        // aese V<ssa_70>.16b, v21.16b                      // ............................................*..................
        // extr x12, x17, x15, #63                          // .......*.......................................................
        // aesmc V<ssa_72>.16b, V<ssa_68>.16b               // ..............................................*................
        // extr x22, x12, x12, #32                          // ........*......................................................
        // extr x10, x12, x8, #63                           // ........*......................................................
        // aese V<ssa_71>.16b, v22.16b                      // ................................................*..............
        // aesmc V<ssa_73>.16b, V<ssa_70>.16b               // ..............................................*................
        // aesmc V<ssa_74>.16b, V<ssa_69>.16b               // .......................................*.......................
        // and W<ssa_75>, w19, w22, asr #31                 // .........*.....................................................
        // aese V<ssa_72>.16b, v22.16b                      // ................................................*..............
        // eor x9, X<ssa_75>, x8, lsl #1                    // ..........*....................................................
        // ldp q29, Q<ssa_77>, [x0, #-32]                   // ....*..........................................................
        // aese V<ssa_73>.16b, v22.16b                      // ................................................*..............
        // aesmc V<ssa_78>.16b, V<ssa_71>.16b               // ..................................................*............
        // aese V<ssa_74>.16b, v20.16b                      // .........................................*.....................
        // aesmc V<ssa_79>.16b, V<ssa_72>.16b               // ..................................................*............
        // aese v25.16b, v16.16b                            // *..............................................................
        // aese V<ssa_78>.16b, v23.16b                      // ....................................................*..........
        // aesmc V<ssa_80>.16b, V<ssa_73>.16b               // ..................................................*............
        // aesmc V<ssa_81>.16b, V<ssa_74>.16b               // ...........................................*...................
        // aesmc V<ssa_82>.16b, v25.16b                     // ...*...........................................................
        // aese V<ssa_79>.16b, v23.16b                      // ....................................................*..........
        // eor V<ssa_83>.16B, V<ssa_78>.16B, v7.16B         // ......................................................*........
        // aese V<ssa_80>.16b, v23.16b                      // ....................................................*..........
        // aese V<ssa_81>.16b, v21.16b                      // .............................................*.................
        // eor V<ssa_84>.16B, V<ssa_79>.16B, v7.16B         // ......................................................*........
        // aese V<ssa_82>.16b, v17.16b                      // .....*.........................................................
        // eor v28.16B, V<ssa_83>.16B, v11.16B              // ........................................................*......
        // aesmc V<ssa_85>.16b, V<ssa_81>.16b               // ...............................................*...............
        // eor V<ssa_86>.16B, V<ssa_80>.16B, v7.16B         // ......................................................*........
        // fmov d11, x9                                     // ........................................................*......
        // eor v3.16B, V<ssa_84>.16B, v6.16B                // ........................................................*......
        // fmov d6, X<ssa_10>                               // ........................................................*......
        // aesmc V<ssa_87>.16b, V<ssa_82>.16b               // .......*.......................................................
        // eor v27.16B, V<ssa_86>.16B, v8.16B               // .........................................................*.....
        // fmov d8, X<ssa_17>                               // ..........................................................*....
        // aese V<ssa_85>.16b, v22.16b                      // .................................................*.............
        // fmov v11.d[1], x10                               // ...........................................................*...
        // aese V<ssa_87>.16b, v12.16b                      // .........*.....................................................
        // fmov v6.d[1], X<ssa_2>                           // ...........................................................*...
        // aesmc v1.16b, V<ssa_85>.16b                      // ...................................................*...........
        // fmov v8.d[1], X<ssa_14>                          // .............................................................*.
        // aesmc v24.16b, V<ssa_87>.16b                     // ...........*...................................................
        // eor v26.16B, V<ssa_77>.16B, v11.16B              // ..............................................................*
        // aese v1.16b, v23.16b                             // .....................................................*.........
        // eor v0.16B, V<ssa_15>.16B, v6.16B                // ..............................................................*
        // aese v24.16b, v13.16b                            // .............*.................................................

        sub x2, x2, #80
Loop5x_xts_enc:
                                             // Instructions:    189
                                             // Expected cycles: 64
                                             // Expected IPC:    2.95
                                             //
                                             // Cycle bound:     64.0
                                             // IPC bound:       2.95
                                             //
                                             // Wall time:     76.62s
                                             // User time:     76.62s
                                             //
                                             // ---------------------- cycle (expected) ----------------------->
                                             // 0                        25                       50
                                             // |------------------------|------------------------|-------------
        eor v25.16B, v1.16B, v7.16B          // *...............................................................
        eor v1.16B, v30.16B, v8.16B          // *...............................................................
        aese v26.16b, v16.16b                // e...............................................................
        str q28, [x1, #64]                   // *...............................................................
        extr x4, x10, x9, #63                // e...............................................................
        extr x22, x10, x10, #32              // e...............................................................
        and w3, w19, w22, asr #31            // .e..............................................................
        ldr q28, [x0, #-48]                  // .*..............................................................
        aesmc v2.16b, v24.16b                // .*..............................................................
        aese v0.16b, v16.16b                 // .e..............................................................
        subs x5, x2, #0x50                   // .e..............................................................
        extr x22, x4, x4, #32                // .e..............................................................
        eor v25.16B, v25.16B, v9.16B         // ..*.............................................................
        aese v1.16b, v16.16b                 // ..e.............................................................
        aesmc v24.16b, v26.16b               // ..e.............................................................
        fmov d9, x15                         // ..*.............................................................
        eor x3, x3, x9, lsl #1               // ..e.............................................................
        csel x5, xzr, x5, gt                 // ..e.............................................................
        aese v2.16b, v14.16b                 // ...*............................................................
        aesmc v26.16b, v0.16b                // ...e............................................................
        and w15, w19, w22, asr #31           // ...e............................................................
        stp q3, q27, [x1], #0x50             // ...*............................................................
        add x0, x0, x5                       // ...e............................................................
        extr x13, x4, x3, #63                // ...e............................................................
        ldp q31, q30, [x0], #0x50            // ....e...........................................................
        aese v24.16b, v17.16b                // ....e...........................................................
        aesmc v0.16b, v1.16b                 // ....e...........................................................
        eor x5, x15, x3, lsl #1              // ....e...........................................................
        extr x22, x13, x13, #32              // ....e...........................................................
        fmov v9.d[1], x17                    // .....*..........................................................
        aesmc v3.16b, v2.16b                 // .....*..........................................................
        aese v26.16b, v17.16b                // .....e..........................................................
        extr x17, x13, x5, #63               // .....e..........................................................
        aese v0.16b, v17.16b                 // ......e.........................................................
        aesmc v2.16b, v24.16b                // ......e.........................................................
        and w9, w19, w22, asr #31            // ......e.........................................................
        extr x22, x17, x17, #32              // ......e.........................................................
        and w14, w19, w22, asr #31           // .......e........................................................
        aese v3.16b, v15.16b                 // .......*........................................................
        aesmc v1.16b, v26.16b                // .......e........................................................
        eor x15, x9, x5, lsl #1              // .......e........................................................
        eor v24.16B, v28.16B, v9.16B         // ........*.......................................................
        aesmc v27.16b, v0.16b                // ........e.......................................................
        aese v2.16b, v12.16b                 // ........e.......................................................
        aese v1.16b, v12.16b                 // .........e......................................................
        aesmc v0.16b, v3.16b                 // .........*......................................................
        aese v24.16b, v16.16b                // ..........e.....................................................
        aese v27.16b, v12.16b                // ..........e.....................................................
        aesmc v28.16b, v2.16b                // ..........e.....................................................
        aesmc v1.16b, v1.16b                 // ...........e....................................................
        aese v0.16b, v4.16b                  // ...........*....................................................
        aesmc v24.16b, v24.16b               // ............e...................................................
        aesmc v27.16b, v27.16b               // ............e...................................................
        aese v28.16b, v13.16b                // ............e...................................................
        aese v1.16b, v13.16b                 // .............e..................................................
        aesmc v3.16b, v0.16b                 // .............*..................................................
        aese v24.16b, v17.16b                // ..............e.................................................
        aese v27.16b, v13.16b                // ..............e.................................................
        aesmc v0.16b, v28.16b                // ..............e.................................................
        aesmc v1.16b, v1.16b                 // ...............e................................................
        aese v3.16b, v5.16b                  // ...............*................................................
        aesmc v24.16b, v24.16b               // ................e...............................................
        aesmc v26.16b, v27.16b               // ................e...............................................
        aese v0.16b, v14.16b                 // ................e...............................................
        aese v1.16b, v14.16b                 // .................e..............................................
        aesmc v3.16b, v3.16b                 // .................*..............................................
        aese v24.16b, v12.16b                // ..................e.............................................
        aese v26.16b, v14.16b                // ..................e.............................................
        aesmc v27.16b, v0.16b                // ..................e.............................................
        aesmc v2.16b, v1.16b                 // ...................e............................................
        aese v3.16b, v18.16b                 // ...................*............................................
        aesmc v26.16b, v26.16b               // ....................e...........................................
        aesmc v0.16b, v24.16b                // ....................e...........................................
        aese v27.16b, v15.16b                // ....................e...........................................
        aese v2.16b, v15.16b                 // .....................e..........................................
        aesmc v1.16b, v3.16b                 // .....................*..........................................
        aese v26.16b, v15.16b                // ......................e.........................................
        aese v0.16b, v13.16b                 // ......................e.........................................
        aesmc v28.16b, v27.16b               // ......................e.........................................
        aese v1.16b, v19.16b                 // .......................*........................................
        aesmc v24.16b, v2.16b                // .......................e........................................
        aese v28.16b, v4.16b                 // ........................e.......................................
        aesmc v0.16b, v0.16b                 // ........................e.......................................
        aesmc v2.16b, v26.16b                // ........................e.......................................
        aesmc v1.16b, v1.16b                 // .........................*......................................
        aese v24.16b, v4.16b                 // .........................e......................................
        aese v0.16b, v14.16b                 // ..........................e.....................................
        aese v2.16b, v4.16b                  // ..........................e.....................................
        aesmc v28.16b, v28.16b               // ..........................e.....................................
        aese v1.16b, v20.16b                 // ...........................*....................................
        aesmc v24.16b, v24.16b               // ...........................e....................................
        aesmc v2.16b, v2.16b                 // ............................e...................................
        aese v28.16b, v5.16b                 // ............................e...................................
        aesmc v0.16b, v0.16b                 // ............................e...................................
        aese v24.16b, v5.16b                 // .............................e..................................
        aesmc v1.16b, v1.16b                 // .............................*..................................
        aese v2.16b, v5.16b                  // ..............................e.................................
        aese v0.16b, v15.16b                 // ..............................e.................................
        aesmc v26.16b, v28.16b               // ..............................e.................................
        aese v1.16b, v21.16b                 // ...............................*................................
        aesmc v28.16b, v24.16b               // ...............................e................................
        aese v26.16b, v18.16b                // ................................e...............................
        aesmc v27.16b, v2.16b                // ................................e...............................
        aesmc v24.16b, v0.16b                // ................................e...............................
        aesmc v0.16b, v1.16b                 // .................................*..............................
        aese v28.16b, v18.16b                // .................................e..............................
        aesmc v1.16b, v26.16b                // ..................................e.............................
        aese v27.16b, v18.16b                // ..................................e.............................
        aese v24.16b, v4.16b                 // ..................................e.............................
        aese v0.16b, v22.16b                 // ...................................*............................
        aesmc v28.16b, v28.16b               // ...................................e............................
        aese v1.16b, v19.16b                 // ....................................e...........................
        aesmc v2.16b, v24.16b                // ....................................e...........................
        aesmc v27.16b, v27.16b               // ....................................e...........................
        aese v28.16b, v19.16b                // .....................................e..........................
        aesmc v26.16b, v0.16b                // .....................................*..........................
        aesmc v24.16b, v1.16b                // ......................................e.........................
        aese v2.16b, v5.16b                  // ......................................e.........................
        aese v27.16b, v19.16b                // ......................................e.........................
        aese v26.16b, v23.16b                // .......................................*........................
        aesmc v0.16b, v28.16b                // .......................................e........................
        aese v24.16b, v20.16b                // ........................................e.......................
        aesmc v28.16b, v2.16b                // ........................................e.......................
        aesmc v1.16b, v27.16b                // ........................................e.......................
        eor v2.16B, v26.16B, v7.16B          // .........................................*......................
        aese v0.16b, v20.16b                 // .........................................e......................
        aesmc v24.16b, v24.16b               // ..........................................e.....................
        aese v28.16b, v18.16b                // ..........................................e.....................
        aese v1.16b, v20.16b                 // ..........................................e.....................
        eor v26.16B, v2.16B, v10.16B         // ...........................................*....................
        fmov d10, x8                         // ...........................................*....................
        eor x8, x14, x15, lsl #1             // ...........................................e....................
        aesmc v2.16b, v0.16b                 // ...........................................e....................
        aese v24.16b, v21.16b                // ............................................e...................
        aesmc v28.16b, v28.16b               // ............................................e...................
        aesmc v1.16b, v1.16b                 // ............................................e...................
        stp q25, q26, [x1, #-48]             // .............................................*..................
        aese v2.16b, v21.16b                 // .............................................e..................
        aesmc v24.16b, v24.16b               // ..............................................e.................
        aese v28.16b, v19.16b                // ..............................................e.................
        aese v1.16b, v21.16b                 // ..............................................e.................
        fmov v10.d[1], x12                   // ..............................................*.................
        extr x12, x17, x15, #63              // ..............................................e.................
        aesmc v0.16b, v2.16b                 // ...............................................e................
        extr x22, x12, x12, #32              // ...............................................e................
        extr x10, x12, x8, #63               // ...............................................e................
        aese v24.16b, v22.16b                // ................................................e...............
        aesmc v1.16b, v1.16b                 // ................................................e...............
        aesmc v28.16b, v28.16b               // ................................................e...............
        and w11, w19, w22, asr #31           // ................................................e...............
        aese v0.16b, v22.16b                 // .................................................e..............
        eor x9, x11, x8, lsl #1              // .................................................e..............
        eor v25.16B, v29.16B, v10.16B        // .................................................*..............
        ldp q29, q2, [x0, #-32]              // .................................................e..............
        aese v1.16b, v22.16b                 // ..................................................e.............
        aesmc v27.16b, v24.16b               // ..................................................e.............
        aese v28.16b, v20.16b                // ..................................................e.............
        aesmc v0.16b, v0.16b                 // ...................................................e............
        aese v25.16b, v16.16b                // ...................................................e............
        aese v27.16b, v23.16b                // ....................................................e...........
        aesmc v1.16b, v1.16b                 // ....................................................e...........
        aesmc v24.16b, v28.16b               // ....................................................e...........
        aesmc v26.16b, v25.16b               // .....................................................e..........
        aese v0.16b, v23.16b                 // .....................................................e..........
        eor v27.16B, v27.16B, v7.16B         // ......................................................e.........
        aese v1.16b, v23.16b                 // ......................................................e.........
        aese v24.16b, v21.16b                // ......................................................e.........
        eor v3.16B, v0.16B, v7.16B           // .......................................................e........
        aese v26.16b, v17.16b                // .......................................................e........
        eor v28.16B, v27.16B, v11.16B        // ........................................................e.......
        aesmc v0.16b, v24.16b                // ........................................................e.......
        eor v27.16B, v1.16B, v7.16B          // ........................................................e.......
        fmov d11, x9                         // ........................................................e.......
        eor v3.16B, v3.16B, v6.16B           // .........................................................e......
        fmov d6, x3                          // .........................................................e......
        aesmc v25.16b, v26.16b               // .........................................................e......
        eor v27.16B, v27.16B, v8.16B         // ..........................................................e.....
        fmov d8, x5                          // ..........................................................e.....
        aese v0.16b, v22.16b                 // ..........................................................e.....
        fmov v11.d[1], x10                   // ...........................................................e....
        aese v25.16b, v12.16b                // ...........................................................e....
        fmov v6.d[1], x4                     // ............................................................e...
        aesmc v1.16b, v0.16b                 // ............................................................e...
        fmov v8.d[1], x13                    // .............................................................e..
        aesmc v24.16b, v25.16b               // .............................................................e..
        eor v26.16B, v2.16B, v11.16B         // ..............................................................e.
        aese v1.16b, v23.16b                 // ..............................................................e.
        eor v0.16B, v31.16B, v6.16B          // ...............................................................e
        aese v24.16b, v13.16b                // ...............................................................e

                                            // ----------------------------------------------- cycle (expected) ------------------------------------------------>
                                            // 0                        25                       50                       75                       100
                                            // |------------------------|------------------------|------------------------|------------------------|-------------
        // aese v0.16b,v16.16b              // .e..............................................................'~................................................
        // aesmc v0.16b,v0.16b              // ...e............................................................'..~..............................................
        // aese v1.16b,v16.16b              // ..e.............................................................'.~...............................................
        // aesmc v1.16b,v1.16b              // ....e...........................................................'...~.............................................
        // aese v24.16b,v16.16b             // ..........e.....................................................'.........~.......................................
        // aesmc v24.16b,v24.16b            // ............e...................................................'...........~.....................................
        // aese v25.16b,v16.16b             // ...................................................e............'.................................................
        // aesmc v25.16b,v25.16b            // .....................................................e..........'.................................................
        // aese v26.16b,v16.16b             // e...............................................................~.................................................
        // aesmc v26.16b,v26.16b            // ..e.............................................................'.~...............................................
        // subs x12,x2,#0x50                // .e..............................................................'~................................................
        // aese v0.16b,v17.16b              // .....e..........................................................'....~............................................
        // aesmc v0.16b,v0.16b              // .......e........................................................'......~..........................................
        // aese v1.16b,v17.16b              // ......e.........................................................'.....~...........................................
        // aesmc v1.16b,v1.16b              // ........e.......................................................'.......~.........................................
        // aese v24.16b,v17.16b             // ..............e.................................................'.............~...................................
        // aesmc v24.16b,v24.16b            // ................e...............................................'...............~.................................
        // aese v25.16b,v17.16b             // .......................................................e........'.................................................
        // aesmc v25.16b,v25.16b            // .........................................................e......'.................................................
        // aese v26.16b,v17.16b             // ....e...........................................................'...~.............................................
        // aesmc v26.16b,v26.16b            // ......e.........................................................'.....~...........................................
        // csel x6,xzr,x12,gt               // ..e.............................................................'.~...............................................
        // aese v0.16b,v12.16b              // .........e......................................................'........~........................................
        // aesmc v0.16b,v0.16b              // ...........e....................................................'..........~......................................
        // aese v1.16b,v12.16b              // ..........e.....................................................'.........~.......................................
        // aesmc v1.16b,v1.16b              // ............e...................................................'...........~.....................................
        // aese v24.16b,v12.16b             // ..................e.............................................'.................~...............................
        // aesmc v24.16b,v24.16b            // ....................e...........................................'...................~.............................
        // aese v25.16b,v12.16b             // ...........................................................e....'.................................................
        // aesmc v25.16b,v25.16b            // .............................................................e..'.................................................
        // aese v26.16b,v12.16b             // ........e.......................................................'.......~.........................................
        // aesmc v26.16b,v26.16b            // ..........e.....................................................'.........~.......................................
        // aese v0.16b,v13.16b              // .............e..................................................'............~....................................
        // aesmc v0.16b,v0.16b              // ...............e................................................'..............~..................................
        // aese v1.16b,v13.16b              // ..............e.................................................'.............~...................................
        // aesmc v1.16b,v1.16b              // ................e...............................................'...............~.................................
        // aese v24.16b,v13.16b             // ......................e.........................................'.....................~...........................
        // aesmc v24.16b,v24.16b            // ........................e.......................................'.......................~.........................
        // aese v25.16b,v13.16b             // ...............................................................e'.................................................
        // aesmc v25.16b,v25.16b            // .~..............................................................'*................................................
        // aese v26.16b,v13.16b             // ............e...................................................'...........~.....................................
        // aesmc v26.16b,v26.16b            // ..............e.................................................'.............~...................................
        // aese v0.16b,v14.16b              // .................e..............................................'................~................................
        // aesmc v0.16b,v0.16b              // ...................e............................................'..................~..............................
        // aese v1.16b,v14.16b              // ..................e.............................................'.................~...............................
        // aesmc v1.16b,v1.16b              // ....................e...........................................'...................~.............................
        // aese v24.16b,v14.16b             // ..........................e.....................................'.........................~.......................
        // aesmc v24.16b,v24.16b            // ............................e...................................'...........................~.....................
        // aese v25.16b,v14.16b             // ...~............................................................'..*..............................................
        // aesmc v25.16b,v25.16b            // .....~..........................................................'....*............................................
        // aese v26.16b,v14.16b             // ................e...............................................'...............~.................................
        // aesmc v26.16b,v26.16b            // ..................e.............................................'.................~...............................
        // aese v0.16b,v15.16b              // .....................e..........................................'....................~............................
        // aesmc v0.16b,v0.16b              // .......................e........................................'......................~..........................
        // aese v1.16b,v15.16b              // ......................e.........................................'.....................~...........................
        // aesmc v1.16b,v1.16b              // ........................e.......................................'.......................~.........................
        // aese v24.16b,v15.16b             // ..............................e.................................'.............................~...................
        // aesmc v24.16b,v24.16b            // ................................e...............................'...............................~.................
        // aese v25.16b,v15.16b             // .......~........................................................'......*..........................................
        // aesmc v25.16b,v25.16b            // .........~......................................................'........*........................................
        // aese v26.16b,v15.16b             // ....................e...........................................'...................~.............................
        // aesmc v26.16b,v26.16b            // ......................e.........................................'.....................~...........................
        // aese v0.16b,v4.16b               // .........................e......................................'........................~........................
        // aesmc v0.16b,v0.16b              // ...........................e....................................'..........................~......................
        // aese v1.16b,v4.16b               // ..........................e.....................................'.........................~.......................
        // aesmc v1.16b,v1.16b              // ............................e...................................'...........................~.....................
        // aese v24.16b,v4.16b              // ..................................e.............................'.................................~...............
        // aesmc v24.16b,v24.16b            // ....................................e...........................'...................................~.............
        // aese v25.16b,v4.16b              // ...........~....................................................'..........*......................................
        // aesmc v25.16b,v25.16b            // .............~..................................................'............*....................................
        // aese v26.16b,v4.16b              // ........................e.......................................'.......................~.........................
        // aesmc v26.16b,v26.16b            // ..........................e.....................................'.........................~.......................
        // aese v0.16b,v5.16b               // .............................e..................................'............................~....................
        // aesmc v0.16b,v0.16b              // ...............................e................................'..............................~..................
        // aese v1.16b,v5.16b               // ..............................e.................................'.............................~...................
        // aesmc v1.16b,v1.16b              // ................................e...............................'...............................~.................
        // aese v24.16b,v5.16b              // ......................................e.........................'.....................................~...........
        // aesmc v24.16b,v24.16b            // ........................................e.......................'.......................................~.........
        // aese v25.16b,v5.16b              // ...............~................................................'..............*..................................
        // aesmc v25.16b,v25.16b            // .................~..............................................'................*................................
        // aese v26.16b,v5.16b              // ............................e...................................'...........................~.....................
        // aesmc v26.16b,v26.16b            // ..............................e.................................'.............................~...................
        // aese v0.16b,v18.16b              // .................................e..............................'................................~................
        // aesmc v0.16b,v0.16b              // ...................................e............................'..................................~..............
        // aese v1.16b,v18.16b              // ..................................e.............................'.................................~...............
        // aesmc v1.16b,v1.16b              // ....................................e...........................'...................................~.............
        // aese v24.16b,v18.16b             // ..........................................e.....................'.........................................~.......
        // aesmc v24.16b,v24.16b            // ............................................e...................'...........................................~.....
        // aese v25.16b,v18.16b             // ...................~............................................'..................*..............................
        // aesmc v25.16b,v25.16b            // .....................~..........................................'....................*............................
        // aese v26.16b,v18.16b             // ................................e...............................'...............................~.................
        // aesmc v26.16b,v26.16b            // ..................................e.............................'.................................~...............
        // add x0,x0,x6                     // ...e............................................................'..~..............................................
        // aese v0.16b,v19.16b              // .....................................e..........................'....................................~............
        // aesmc v0.16b,v0.16b              // .......................................e........................'......................................~..........
        // aese v1.16b,v19.16b              // ......................................e.........................'.....................................~...........
        // aesmc v1.16b,v1.16b              // ........................................e.......................'.......................................~.........
        // aese v24.16b,v19.16b             // ..............................................e.................'.............................................~...
        // aesmc v24.16b,v24.16b            // ................................................e...............'...............................................~.
        // aese v25.16b,v19.16b             // .......................~........................................'......................*..........................
        // aesmc v25.16b,v25.16b            // .........................~......................................'........................*........................
        // aese v26.16b,v19.16b             // ....................................e...........................'...................................~.............
        // aesmc v26.16b,v26.16b            // ......................................e.........................'.....................................~...........
        // aese v0.16b,v20.16b              // .........................................e......................'........................................~........
        // aesmc v0.16b,v0.16b              // ...........................................e....................'..........................................~......
        // aese v1.16b,v20.16b              // ..........................................e.....................'.........................................~.......
        // aesmc v1.16b,v1.16b              // ............................................e...................'...........................................~.....
        // aese v24.16b,v20.16b             // ..................................................e.............'.................................................
        // aesmc v24.16b,v24.16b            // ....................................................e...........'.................................................
        // aese v25.16b,v20.16b             // ...........................~....................................'..........................*......................
        // aesmc v25.16b,v25.16b            // .............................~..................................'............................*....................
        // aese v26.16b,v20.16b             // ........................................e.......................'.......................................~.........
        // aesmc v26.16b,v26.16b            // ..........................................e.....................'.........................................~.......
        // aese v0.16b,v21.16b              // .............................................e..................'............................................~....
        // aesmc v0.16b,v0.16b              // ...............................................e................'..............................................~..
        // aese v1.16b,v21.16b              // ..............................................e.................'.............................................~...
        // aesmc v1.16b,v1.16b              // ................................................e...............'...............................................~.
        // aese v24.16b,v21.16b             // ......................................................e.........'.................................................
        // aesmc v24.16b,v24.16b            // ........................................................e.......'.................................................
        // aese v25.16b,v21.16b             // ...............................~................................'..............................*..................
        // aesmc v25.16b,v25.16b            // .................................~..............................'................................*................
        // aese v26.16b,v21.16b             // ............................................e...................'...........................................~.....
        // aesmc v26.16b,v26.16b            // ..............................................e.................'.............................................~...
        // aese v0.16b,v22.16b              // .................................................e..............'.................................................
        // aesmc v0.16b,v0.16b              // ...................................................e............'.................................................
        // aese v1.16b,v22.16b              // ..................................................e.............'.................................................
        // aesmc v1.16b,v1.16b              // ....................................................e...........'.................................................
        // aese v24.16b,v22.16b             // ..........................................................e.....'.................................................
        // aesmc v24.16b,v24.16b            // ............................................................e...'.................................................
        // aese v25.16b,v22.16b             // ...................................~............................'..................................*..............
        // aesmc v25.16b,v25.16b            // .....................................~..........................'....................................*............
        // aese v26.16b,v22.16b             // ................................................e...............'...............................................~.
        // aesmc v26.16b,v26.16b            // ..................................................e.............'.................................................
        // aese v0.16b,v23.16b              // .....................................................e..........'.................................................
        // aese v1.16b,v23.16b              // ......................................................e.........'.................................................
        // aese v24.16b,v23.16b             // ..............................................................e.'.................................................
        // aese v25.16b,v23.16b             // .......................................~........................'......................................*..........
        // aese v26.16b,v23.16b             // ....................................................e...........'.................................................
        // eor v0.16b,v0.16b,v7.16b         // .......................................................e........'.................................................
        // eor v0.16b,v0.16b,v6.16b         // .........................................................e......'.................................................
        // extr x22,x10,x10,#32             // e...............................................................~.................................................
        // extr x10,x10,x9,#63              // e...............................................................~.................................................
        // and w11,w19,w22,asr#31           // .e..............................................................'~................................................
        // eor x9,x11,x9,lsl#1              // ..e.............................................................'.~...............................................
        // fmov d6,x9                       // .........................................................e......'.................................................
        // fmov v6.d[1],x10                 // ............................................................e...'.................................................
        // eor v1.16b,v1.16b,v7.16b         // ........................................................e.......'.................................................
        // eor v1.16b,v1.16b,v8.16b         // ..........................................................e.....'.................................................
        // ldp q2, q3, [x0], #0x50          // ....e...........................................................'...~.............................................
        // extr x22,x10,x10,#32             // .e..............................................................'~................................................
        // extr x10,x10,x9,#63              // ...e............................................................'..~..............................................
        // and w11,w19,w22,asr#31           // ...e............................................................'..~..............................................
        // eor x9,x11,x9,lsl#1              // ....e...........................................................'...~.............................................
        // fmov d8,x9                       // ..........................................................e.....'.................................................
        // fmov v8.d[1],x10                 // .............................................................e..'.................................................
        // eor v24.16b,v24.16b,v7.16b       // ~...............................................................*.................................................
        // eor v24.16b,v24.16b,v9.16b       // ..~.............................................................'.*...............................................
        // extr x22,x10,x10,#32             // ....e...........................................................'...~.............................................
        // extr x10,x10,x9,#63              // .....e..........................................................'....~............................................
        // and w11,w19,w22,asr#31           // ......e.........................................................'.....~...........................................
        // eor x9,x11,x9,lsl#1              // .......e........................................................'......~..........................................
        // fmov d9,x9                       // ..~.............................................................'.*...............................................
        // fmov v9.d[1],x10                 // .....~..........................................................'....*............................................
        // eor v25.16b,v25.16b,v7.16b       // .........................................~......................'........................................*........
        // eor v25.16b,v25.16b,v10.16b      // ...........................................~....................'..........................................*......
        // ldr q27, [x0, #-0x30]            // .~..............................................................'*................................................
        // extr x22,x10,x10,#32             // ......e.........................................................'.....~...........................................
        // extr x10,x10,x9,#63              // ..............................................e.................'.............................................~...
        // and w11,w19,w22,asr#31           // .......e........................................................'......~..........................................
        // eor x9,x11,x9,lsl#1              // ...........................................e....................'..........................................~......
        // fmov d10,x9                      // ...........................................~....................'..........................................*......
        // fmov v10.d[1],x10                // ..............................................~.................'.............................................*...
        // eor v26.16b,v26.16b,v7.16b       // ......................................................e.........'.................................................
        // eor v26.16b,v26.16b,v11.16b      // ........................................................e.......'.................................................
        // ldp q28, q29,[x0, #-0x20]        // .................................................e..............'.................................................
        // extr x22,x10,x10,#32             // ...............................................e................'..............................................~..
        // extr x10,x10,x9,#63              // ...............................................e................'..............................................~..
        // and w11,w19,w22,asr #31          // ................................................e...............'...............................................~.
        // eor x9,x11,x9,lsl #1             // .................................................e..............'.................................................
        // fmov d11,x9                      // ........................................................e.......'.................................................
        // fmov v11.d[1],x10                // ...........................................................e....'.................................................
        // stp q0, q1, [x1], #0x50          // ...~............................................................'..*..............................................
        // stp q24, q25, [x1, #-0x30]       // .............................................~..................'............................................*....
        // str q26, [x1, #-0x10]            // ~...............................................................*.................................................
        // eor v0.16b,v2.16b,v6.16b         // ...............................................................e'.................................................
        // eor v1.16b,v3.16b,v8.16b         // ~...............................................................*.................................................
        // eor v24.16b,v27.16b,v9.16b       // ........~.......................................................'.......*.........................................
        // eor v25.16b,v28.16b,v10.16b      // .................................................~..............'................................................*
        // eor v26.16b,v29.16b,v11.16b      // ..............................................................e.'.................................................

        subs x2, x2, #0x50
        b.hs Loop5x_xts_enc
                                             // Instructions:    35
                                             // Expected cycles: 49
                                             // Expected IPC:    0.71
                                             //
                                             // Cycle bound:     49.0
                                             // IPC bound:       0.71
                                             //
                                             // Wall time:     0.16s
                                             // User time:     0.16s
                                             //
                                             // --------------- cycle (expected) --------------->
                                             // 0                        25
                                             // |------------------------|-----------------------
        stp q3, q27, [x1], #0x50             // *................................................
        str q28, [x1, #-16]                  // *................................................
        aesmc v2.16b, v24.16b                // *................................................
        eor v25.16B, v1.16B, v7.16B          // *................................................
        eor v1.16B, v30.16B, v8.16B          // .*...............................................
        ldr q28, [x0, #-48]                  // .*...............................................
        eor v31.16B, v25.16B, v9.16B         // ..*..............................................
        aese v2.16b, v14.16b                 // ..*..............................................
        fmov d9, x15                         // ..*..............................................
        aesmc v25.16b, v2.16b                // ....*............................................
        fmov v9.d[1], x17                    // .....*...........................................
        aese v25.16b, v15.16b                // ......*..........................................
        eor v24.16B, v28.16B, v9.16B         // ........*........................................
        aesmc v30.16b, v25.16b               // ........*........................................
        aese v30.16b, v4.16b                 // ..........*......................................
        aesmc v25.16b, v30.16b               // ............*....................................
        aese v25.16b, v5.16b                 // ..............*..................................
        aesmc v3.16b, v25.16b                // ................*................................
        aese v3.16b, v18.16b                 // ..................*..............................
        aesmc v27.16b, v3.16b                // ....................*............................
        aese v27.16b, v19.16b                // ......................*..........................
        aesmc v25.16b, v27.16b               // ........................*........................
        aese v25.16b, v20.16b                // ..........................*......................
        aesmc v30.16b, v25.16b               // ............................*....................
        aese v30.16b, v21.16b                // ..............................*..................
        aesmc v27.16b, v30.16b               // ................................*................
        aese v27.16b, v22.16b                // ..................................*..............
        aesmc v28.16b, v27.16b               // ....................................*............
        aese v28.16b, v23.16b                // ......................................*..........
        eor v3.16B, v28.16B, v7.16B          // ........................................*........
        eor v2.16B, v3.16B, v10.16B          // ..........................................*......
        fmov d10, x8                         // ..........................................*......
        stp q31, q2, [x1, #-48]              // ............................................*....
        fmov v10.d[1], x12                   // .............................................*...
        eor v25.16B, v29.16B, v10.16B        // ................................................*

                                                          // --------------- cycle (expected) --------------->
                                                          // 0                        25
                                                          // |------------------------|-----------------------
        // eor V<ssa_0>.16B, v1.16B, v7.16B               // *................................................
        // eor v1.16B, v30.16B, v8.16B                    // .*...............................................
        // str q28, [x1, #64]                             // *................................................
        // ldr Q<ssa_4>, [x0, #-48]                       // .*...............................................
        // aesmc V<ssa_5>.16b, v24.16b                    // *................................................
        // eor V<ssa_8>.16B, V<ssa_0>.16B, v9.16B         // ..*..............................................
        // fmov d9, x15                                   // ..*..............................................
        // aese V<ssa_5>.16b, v14.16b                     // ..*..............................................
        // stp q3, q27, [x1], #0x50                       // *................................................
        // fmov v9.d[1], x17                              // .....*...........................................
        // aesmc V<ssa_18>.16b, V<ssa_5>.16b              // ....*............................................
        // aese V<ssa_18>.16b, v15.16b                    // ......*..........................................
        // eor v24.16B, V<ssa_4>.16B, v9.16B              // ........*........................................
        // aesmc V<ssa_25>.16b, V<ssa_18>.16b             // ........*........................................
        // aese V<ssa_25>.16b, v4.16b                     // ..........*......................................
        // aesmc V<ssa_30>.16b, V<ssa_25>.16b             // ............*....................................
        // aese V<ssa_30>.16b, v5.16b                     // ..............*..................................
        // aesmc V<ssa_35>.16b, V<ssa_30>.16b             // ................*................................
        // aese V<ssa_35>.16b, v18.16b                    // ..................*..............................
        // aesmc V<ssa_40>.16b, V<ssa_35>.16b             // ....................*............................
        // aese V<ssa_40>.16b, v19.16b                    // ......................*..........................
        // aesmc V<ssa_45>.16b, V<ssa_40>.16b             // ........................*........................
        // aese V<ssa_45>.16b, v20.16b                    // ..........................*......................
        // aesmc V<ssa_50>.16b, V<ssa_45>.16b             // ............................*....................
        // aese V<ssa_50>.16b, v21.16b                    // ..............................*..................
        // aesmc V<ssa_55>.16b, V<ssa_50>.16b             // ................................*................
        // aese V<ssa_55>.16b, v22.16b                    // ..................................*..............
        // aesmc V<ssa_60>.16b, V<ssa_55>.16b             // ....................................*............
        // aese V<ssa_60>.16b, v23.16b                    // ......................................*..........
        // eor V<ssa_65>.16B, V<ssa_60>.16B, v7.16B       // ........................................*........
        // eor V<ssa_67>.16B, V<ssa_65>.16B, v10.16B      // ..........................................*......
        // fmov d10, x8                                   // ..........................................*......
        // stp Q<ssa_8>, Q<ssa_67>, [x1, #-48]            // ............................................*....
        // fmov v10.d[1], x12                             // .............................................*...
        // eor v25.16B, v29.16B, v10.16B                  // ................................................*



    // If left 4 blocks, continue from Lxts_enc_tail4x.
    // Otherwise, continue processing
    // 0, 1, 2 or 3 blocks (with or without tail) starting at
    // Loop5x_enc_after
 cmn	x2,#0x10
 b.ne	Loop5x_enc_after
    b.eq  Lxts_enc_tail4x

Loop5x_enc_after:
 add	x2,x2,#0x50
 cbz	x2,Lxts_enc_done     // no blocks left

 add	w6,w5,#2
 subs	x2,x2,#0x30
 b.lo	Lxts_inner_enc_tail    // 1 or 2 blocks left
                                    // (with tail or not)

 eor	v0.16b,v6.16b,v27.16b         // 3 blocks left
 eor	v1.16b,v8.16b,v28.16b
 eor	v24.16b,v29.16b,v9.16b
 b	Lxts_outer_enc_tail

.align	4
Lxts_enc_tail4x:
 orr	v11.16b,v10.16b,v10.16b
 orr	v10.16b,v9.16b,v9.16b
 orr	v9.16b,v8.16b,v8.16b
 orr	v8.16b,v6.16b,v6.16b
 fmov	x9,d11
 fmov	x10,v11.d[1]
 eor	v1.16b,v8.16b,v3.16b
 eor	v24.16b,v27.16b,v9.16b
 eor	v25.16b,v28.16b,v10.16b
 eor	v26.16b,v29.16b,v11.16b

 aese	v1.16b,v16.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v16.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v16.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v16.16b
 aesmc	v26.16b,v26.16b
 subs	x2,x2,#0x50         // because Lxts_enc_tail4x

 aese	v1.16b,v17.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v17.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v17.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v17.16b
 aesmc	v26.16b,v26.16b
 csel	x6,xzr,x2,gt    // borrow x6, w6, "gt" is not typo

 aese	v1.16b,v12.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v12.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v12.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v12.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v13.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v13.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v13.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v13.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v14.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v14.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v14.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v14.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v15.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v15.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v15.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v15.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v4.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v4.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v4.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v4.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v5.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v5.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v5.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v5.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v18.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v18.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v18.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v18.16b
 aesmc	v26.16b,v26.16b
 add	x0,x0,x6  // x0 is adjusted in such way that
                                // at exit from the loop v1.16b-v26.16b
                                // are loaded with last "words"

 aese	v1.16b,v19.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v19.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v19.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v19.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v20.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v20.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v20.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v20.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v21.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v21.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v21.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v21.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v22.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v22.16b
 aesmc	v24.16b,v24.16b
 aese	v25.16b,v22.16b
 aesmc	v25.16b,v25.16b
 aese	v26.16b,v22.16b
 aesmc	v26.16b,v26.16b

 aese	v1.16b,v23.16b
 aese	v24.16b,v23.16b
 aese	v25.16b,v23.16b
 aese	v26.16b,v23.16b

    // The iv for first block of one iteration
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d6,x9
 fmov	v6.d[1],x10
    eor	v1.16b,v1.16b,v7.16b
    eor	v1.16b,v1.16b,v8.16b
 ld1	{v2.16b},[x0],#16
    // The iv for second block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d8,x9
 fmov	v8.d[1],x10
    eor	v24.16b,v24.16b,v7.16b
    eor	v24.16b,v24.16b,v9.16b
    ld1	{v3.16b},[x0],#16
    // The iv for third block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d9,x9
 fmov	v9.d[1],x10
    eor	v25.16b,v25.16b,v7.16b
    eor	v25.16b,v25.16b,v10.16b
 ld1	{v27.16b},[x0],#16
    // The iv for fourth block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d10,x9
 fmov	v10.d[1],x10
    eor	v26.16b,v26.16b,v7.16b
    eor	v26.16b,v26.16b,v11.16b
 ld1	{v28.16b},[x0],#16
 ld1	{v29.16b},[x0],#16

 add	x0,x0,#16
    st1  {v1.16b},[x1],#16
    st1	{v24.16b,v25.16b},[x1],#32
    st1  {v26.16b},[x1],#16
 b	Lxts_enc_done
.align	4
Lxts_outer_enc_tail:
  // First round with v16
  aese	v0.16b,v16.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v16.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v16.16b
  aesmc	v24.16b,v24.16b

  // Second round with v17
  aese	v0.16b,v17.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v17.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v17.16b
  aesmc	v24.16b,v24.16b

  // Third round with v12
  aese	v0.16b,v12.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v12.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v12.16b
  aesmc	v24.16b,v24.16b

  // Fourth round with v13
  aese	v0.16b,v13.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v13.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v13.16b
  aesmc	v24.16b,v24.16b

  // Fifth round with v14
  aese	v0.16b,v14.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v14.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v14.16b
  aesmc	v24.16b,v24.16b

  // Sixth round with v15
  aese	v0.16b,v15.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v15.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v15.16b
  aesmc	v24.16b,v24.16b

  // Seventh round with v4
  aese	v0.16b,v4.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v4.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v4.16b
  aesmc	v24.16b,v24.16b

  // Eighth round with v5
  aese	v0.16b,v5.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v5.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v5.16b
  aesmc	v24.16b,v24.16b

  // 9th round with v18
  aese	v0.16b,v18.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v18.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v18.16b
  aesmc	v24.16b,v24.16b

  // 10th round with v19
  aese	v0.16b,v19.16b
  aesmc	v0.16b,v0.16b
  aese	v1.16b,v19.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v19.16b
  aesmc	v24.16b,v24.16b


 aese	v0.16b,v20.16b
 aesmc	v0.16b,v0.16b
 aese	v1.16b,v20.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v20.16b
 aesmc	v24.16b,v24.16b
 aese	v0.16b,v21.16b
 aesmc	v0.16b,v0.16b
 aese	v1.16b,v21.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v21.16b
 aesmc	v24.16b,v24.16b
 aese	v0.16b,v22.16b
 aesmc	v0.16b,v0.16b
 aese	v1.16b,v22.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v22.16b
 aesmc	v24.16b,v24.16b
 aese	v0.16b,v23.16b
 aese	v1.16b,v23.16b
 aese	v24.16b,v23.16b

 eor	v30.16b,v6.16b,v7.16b
 eor	v11.16b,v9.16b,v7.16b
 subs	x2,x2,#0x30
    // The iv for first block
 fmov	x9,d9
 fmov	x10,v9.d[1]
    // mov   w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d6,x9
 fmov	v6.d[1],x10
 eor	v10.16b,v8.16b,v7.16b
 csel	x6,x2,x6,lo   // x6, w6, is zero at this point

 add	x6,x6,#0x20
 add	x0,x0,x6
 mov	x7,x3

 ld1	{v27.16b},[x0],#16
 add	w6,w5,#2
 eor	v30.16b,v30.16b,v0.16b
 eor	v31.16b,v10.16b,v1.16b
 eor	v24.16b,v24.16b,v11.16b
 ld1	{v16.4s,v17.4s},[x7],#32
 st1	{v30.16b,v31.16b},[x1],#32
 st1	{v24.16b},[x1],#16
 cmn	x2,#0x30
 b.eq	Lxts_enc_done
Lxts_encxor_one:
 orr	v28.16b,v3.16b,v3.16b
 orr	v29.16b,v27.16b,v27.16b
 nop

Lxts_inner_enc_tail:
 cmn	x2,#0x10
 eor	v1.16b,v28.16b,v6.16b
 eor	v24.16b,v29.16b,v8.16b
 b.eq	Lxts_enc_tail_loop
 eor	v24.16b,v29.16b,v6.16b
Lxts_enc_tail_loop:
  // First round with v16
  aese	v1.16b,v16.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v16.16b
  aesmc	v24.16b,v24.16b

  // Second round with v17
  aese	v1.16b,v17.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v17.16b
  aesmc	v24.16b,v24.16b

  // Third round with v12
  aese	v1.16b,v12.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v12.16b
  aesmc	v24.16b,v24.16b

  // Fourth round with v13
  aese	v1.16b,v13.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v13.16b
  aesmc	v24.16b,v24.16b

  // Fifth round with v14
  aese	v1.16b,v14.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v14.16b
  aesmc	v24.16b,v24.16b

  // Sixth round with v15
  aese	v1.16b,v15.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v15.16b
  aesmc	v24.16b,v24.16b

  // Seventh round with v4
  aese	v1.16b,v4.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v4.16b
  aesmc	v24.16b,v24.16b

  // Eighth round with v5
  aese	v1.16b,v5.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v5.16b
  aesmc	v24.16b,v24.16b

  // 9th round with v18
  aese	v1.16b,v18.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v18.16b
  aesmc	v24.16b,v24.16b

  // 10th round with v19
  aese	v1.16b,v19.16b
  aesmc	v1.16b,v1.16b
  aese	v24.16b,v19.16b
  aesmc	v24.16b,v24.16b

 aese	v1.16b,v20.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v20.16b
 aesmc	v24.16b,v24.16b
 cmn	x2,#0x20
 aese	v1.16b,v21.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v21.16b
 aesmc	v24.16b,v24.16b
 eor	v5.16b,v6.16b,v7.16b
 aese	v1.16b,v22.16b
 aesmc	v1.16b,v1.16b
 aese	v24.16b,v22.16b
 aesmc	v24.16b,v24.16b
 eor	v17.16b,v8.16b,v7.16b
 aese	v1.16b,v23.16b
 aese	v24.16b,v23.16b
 b.eq	Lxts_enc_one
 eor	v5.16b,v5.16b,v1.16b
 st1	{v5.16b},[x1],#16
 eor	v17.16b,v17.16b,v24.16b
 orr	v6.16b,v8.16b,v8.16b
 st1	{v17.16b},[x1],#16
 fmov	x9,d8
 fmov	x10,v8.d[1]
 mov	w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr #31
 eor	x9,x11,x9,lsl #1
 fmov	d6,x9
 fmov	v6.d[1],x10
 b	Lxts_enc_done

Lxts_enc_one:
 eor	v5.16b,v5.16b,v24.16b
 orr	v6.16b,v6.16b,v6.16b
 st1	{v5.16b},[x1],#16
 fmov	x9,d6
 fmov	x10,v6.d[1]
 mov	w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr #31
 eor	x9,x11,x9,lsl #1
 fmov	d6,x9
 fmov	v6.d[1],x10
 b	Lxts_enc_done
.align	5
Lxts_enc_done:
    // Process the tail block with cipher stealing.
 tst	x21,#0xf
 b.eq	Lxts_abort

 mov	x20,x0
 mov	x13,x1
 sub	x1,x1,#16
.composite_enc_loop:
 subs	x21,x21,#1
 ldrb	w15,[x1,x21]
 ldrb	w14,[x20,x21]
 strb	w15,[x13,x21]
 strb	w14,[x1,x21]
 b.gt	.composite_enc_loop
Lxts_enc_load_done:
 ld1	{v26.16b},[x1]
 eor	v26.16b,v26.16b,v6.16b

    // Encrypt the composite block to get the last second encrypted text block
 ldr	w6,[x3,#240]        // load key schedule...
 ld1	{v0.16b},[x3],#16
 sub	w6,w6,#2
 ld1	{v1.16b},[x3],#16     // load key schedule...
Loop_final_enc:
 aese	v26.16b,v0.16b
 aesmc	v26.16b,v26.16b
 ld1	{v0.4s},[x3],#16
 subs	w6,w6,#2
 aese	v26.16b,v1.16b
 aesmc	v26.16b,v26.16b
 ld1	{v1.4s},[x3],#16
 b.gt	Loop_final_enc

 aese	v26.16b,v0.16b
 aesmc	v26.16b,v26.16b
 ld1	{v0.4s},[x3]
 aese	v26.16b,v1.16b
 eor	v26.16b,v26.16b,v0.16b
 eor	v26.16b,v26.16b,v6.16b
 st1	{v26.16b},[x1]

Lxts_abort:
 ldp	x21,x22,[sp,#16]
 ldp	x19,x20,[sp],#32
Lxts_enc_final_abort:
    restore_vregs
    add sp, sp, #STACK_SIZE_VREGS
 ret

#endif
#endif  // !OPENSSL_NO_ASM && defined(__AARCH64EL__) && defined(__APPLE__)
#if defined(__ELF__)
// See https: // www.airs.com/blog/archives/518.
.section .note.GNU-stack,"",%progbits
#endif
