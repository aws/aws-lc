// The following xts encrypt is from MacBook M3 build folder
// after moving around some instructions

#if !defined(__has_feature)
#define __has_feature(x) 0
#endif
#if __has_feature(memory_sanitizer) && !defined(OPENSSL_NO_ASM)
#define OPENSSL_NO_ASM
#endif

#include <openssl/asm_base.h>

#if !defined(OPENSSL_NO_ASM) && defined(__AARCH64EL__)
#if defined(__ELF__)
#include <openssl/boringssl_prefix_symbols_asm.h>
#include <openssl/arm_arch.h>
.arch   armv8-a+crypto
.text
.globl  aes_hw_slothy_xts_encrypt
.hidden aes_hw_slothy_xts_encrypt
.type   aes_hw_slothy_xts_encrypt,%function
#elif defined(__APPLE__)
#if defined(BORINGSSL_PREFIX)
#include <boringssl_prefix_symbols_asm.h>
#endif
#include <openssl/arm_arch.h>
.text
.globl	_aes_hw_slothy_xts_encrypt
.private_extern	_aes_hw_slothy_xts_encrypt
#else
#error Unknown configuration
#endif

#if __ARM_MAX_ARCH__ >= 8

.align	4


#define STACK_BASE_VREGS 0
#define STACK_SIZE_VREGS (4*16)

.macro save_vregs
        stp  d8,  d9, [sp, #(STACK_BASE_VREGS + 16*0)]
        stp d10, d11, [sp, #(STACK_BASE_VREGS + 16*1)]
        stp d12, d13, [sp, #(STACK_BASE_VREGS + 16*2)]
        stp d14, d15, [sp, #(STACK_BASE_VREGS + 16*3)]
.endm

.macro restore_vregs
        ldp  d8,  d9, [sp, #(STACK_BASE_VREGS + 16*0)]
        ldp d10, d11, [sp, #(STACK_BASE_VREGS + 16*1)]
        ldp d12, d13, [sp, #(STACK_BASE_VREGS + 16*2)]
        ldp d14, d15, [sp, #(STACK_BASE_VREGS + 16*3)]
.endm

// A single AES round
// Prevent SLOTHY from unfolding because uArchs tend to fuse AESMC+AESE
.macro aesr data, key // @slothy:no-unfold
        aese  \data, \key
        aesmc \data, \data
.endm

_aes_hw_slothy_xts_encrypt:
aes_hw_slothy_xts_encrypt:
 # AARCH64_VALID_CALL_TARGET

    sub sp, sp, #STACK_SIZE_VREGS
    save_vregs

 cmp	x2,#16
    // Original input data size bigger than 16, jump to big size processing.
 b.ne	Lxts_enc_big_size
    // Encrypt the iv with key2, as the first XEX iv.
 ldr	w6,[x4,#240]
 ld1	{v0.16b},[x4],#16
 ld1	{v6.16b},[x5]
 sub	w6,w6,#2
 ld1	{v1.16b},[x4],#16

Loop_enc_iv_enc:
 aesr    v6.16b, v0.16b
 ld1	{v0.4s},[x4],#16
 aesr    v6.16b, v1.16b
 ld1	{v1.4s},[x4],#16
 subs	w6,w6,#2
 cbnz	w6,Loop_enc_iv_enc

 aesr    v6.16b, v0.16b
 ld1	{v0.4s},[x4]
 aese	v6.16b,v1.16b
 eor	v6.16b,v6.16b,v0.16b

 ld1	{v0.16b},[x0]
 eor	v0.16b,v6.16b,v0.16b

 ldr	w6,[x3,#240]
 ld1	{v28.4s,v29.4s},[x3],#32       // load key schedule...

 aesr    v0.16b, v28.16b
 ld1	{v16.4s,v17.4s},[x3],#32         // load key schedule...
 aesr    v0.16b, v29.16b
 subs	w6,w6,#10     // if rounds==10, jump to aes-128-xts processing
// b.eq    .Lxts_128_enc
Lxts_enc_round_loop:
 aesr    v0.16b, v16.16b
 ld1	{v16.4s},[x3],#16            // load key schedule...
 aesr    v0.16b, v17.16b
 ld1	{v17.4s},[x3],#16            // load key schedule...
 subs	w6,w6,#2          // bias
 b.gt	Lxts_enc_round_loop
// .Lxts_128_enc:
 ld1	{v18.4s,v19.4s},[x3],#32       // load key schedule...
 aesr    v0.16b, v16.16b
 aesr    v0.16b, v17.16b
 ld1	{v20.4s,v21.4s},[x3],#32       // load key schedule...
 aesr    v0.16b, v18.16b
 aesr    v0.16b, v19.16b
 ld1	{v22.4s,v23.4s},[x3],#32       // load key schedule...
 aesr    v0.16b, v20.16b
 aesr    v0.16b, v21.16b
 ld1	{v7.4s},[x3]
 aesr    v0.16b, v22.16b
 aese	v0.16b,v23.16b
 eor	v0.16b,v0.16b,v7.16b
 eor	v0.16b,v0.16b,v6.16b
 st1	{v0.16b},[x1]
 b	Lxts_enc_final_abort

.align	4
Lxts_enc_big_size:
   // Encrypt input size > 16 bytes
 stp	x19,x20,[sp,#-32]!
 stp	x21,x22,[sp,#16]

    // tailcnt store the tail value of length%16.
 and	x21,x2,#0xf
 and	x2,x2,#-16    // len &= 0x1..110000, now divisible by 16
 subs	x2,x2,#16
 mov	x8,#16
 b.lo	Lxts_abort         // if !(len > 16): error
 csel	x8,xzr,x8,eq  // if (len == 16): step = 0

    // Firstly, encrypt the iv with key2, as the first iv of XEX.
 ldr	w6,[x4,#240]
 ld1	{v0.4s},[x4],#16
 ld1	{v6.16b},[x5]
 sub	w6,w6,#2
 ld1	{v1.4s},[x4],#16

Loop_iv_enc:
 aesr    v6.16b, v0.16b
 ld1	{v0.4s},[x4],#16
 subs	w6,w6,#2
 aesr    v6.16b, v1.16b
 ld1	{v1.4s},[x4],#16
 b.gt	Loop_iv_enc

 aesr    v6.16b, v0.16b
 ld1	{v0.4s},[x4]
 aese	v6.16b,v1.16b
 eor	v6.16b,v6.16b,v0.16b

    // The iv for second block
    // x9- iv(low), x10 - iv(high)
    // the five ivs stored into, v6.16b,v8.16b,v9.16b,v10.16b,v11.16b
 fmov	x9,d6
 fmov	x10,v6.d[1]
 mov	w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d8,x9
 fmov	v8.d[1],x10

 ldr	w5,[x3,#240]       // next starting point
 ld1	{v0.16b},[x0],x8

    mov x7, x3
 ld1	{v16.4s,v17.4s},[x7], #32         // load key schedule...
    ld1 {v12.4s,v13.4s},[x7], #32
 ld1	{v14.4s,v15.4s},[x7], #32
    ld1 {v4.4s,v5.4s},  [x7], #32
    ld1	{v18.4s,v19.4s},[x7], #32
 ld1	{v20.4s,v21.4s},[x7], #32
 ld1	{v22.4s,v23.4s},[x7], #32
 ld1	{v7.4s},        [x7]

 sub	w5,w5,#8
 add	x7,x3,#32
 mov	w6,w5

    // Encryption
Lxts_enc:
 ld1	{v24.16b},[x0],#16
 subs	x2,x2,#32           // bias
 add	w6,w5,#2
 orr	v28.16b,v0.16b,v0.16b
 orr	v29.16b,v24.16b,v24.16b
 b.lo	Lxts_inner_enc_tail    // when input size % 5 = 1 or 2
                                    // (with tail or not)
 eor	v0.16b,v0.16b,v6.16b          // before encryption, xor with iv
 eor	v24.16b,v24.16b,v8.16b

    // The iv for third block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d9,x9
 fmov	v9.d[1],x10


 orr	v1.16b,v24.16b,v24.16b
 ld1	{v24.16b},[x0],#16
 orr	v2.16b,v0.16b,v0.16b
 orr	v3.16b,v1.16b,v1.16b
 eor	v27.16b,v24.16b,v9.16b         // the third block
 eor	v24.16b,v24.16b,v9.16b
 cmp	x2,#32
 b.lo	Lxts_outer_enc_tail

    // The iv for fourth block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d10,x9
 fmov	v10.d[1],x10

 ld1	{v25.16b},[x0],#16
    // The iv for fifth block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d11,x9
 fmov	v11.d[1],x10

 ld1	{v26.16b},[x0],#16
 eor	v25.16b,v25.16b,v10.16b        // the fourth block
 eor	v26.16b,v26.16b,v11.16b
 sub	x2,x2,#32           // bias
 mov	w6,w5

.align	4
                                             // Instructions:    127
                                             // Expected cycles: 41
                                             // Expected IPC:    3.10
                                             //
                                             // Cycle bound:     41.0
                                             // IPC bound:       3.10
                                             //
                                             // Wall time:     0.53s
                                             // User time:     0.53s
                                             //
                                             // ----------- cycle (expected) ----------->
                                             // 0                        25
                                             // |------------------------|---------------
        aesr v1.16b, v16.16b                 // *........................................
        aesr v0.16b, v16.16b                 // *........................................
        aesr v26.16b, v16.16b                // *........................................
        aesr v25.16b, v16.16b                // *........................................
        extr x22, x10, x10, #32              // *........................................
        extr x11, x10, x9, #63               // *........................................
        aesr v24.16b, v16.16b                // .*.......................................
        and w4, w19, w22, asr #31            // .*.......................................
        extr x22, x11, x11, #32              // .*.......................................
        subs x14, x2, #0x50                  // .*.......................................
        eor x17, x4, x9, lsl #1              // ..*......................................
        aesr v0.16b, v17.16b                 // ..*......................................
        aesr v25.16b, v17.16b                // ..*......................................
        aesr v1.16b, v17.16b                 // ..*......................................
        and w10, w19, w22, asr #31           // ..*......................................
        csel x14, xzr, x14, gt               // ..*......................................
        add x0, x0, x14                      // ...*.....................................
        aesr v26.16b, v17.16b                // ...*.....................................
        aesr v24.16b, v17.16b                // ...*.....................................
        eor x6, x10, x17, lsl #1             // ...*.....................................
        subs x15, x2, #0x50                  // ...*.....................................
        extr x12, x11, x17, #63              // ...*.....................................
        aesr v0.16b, v12.16b                 // ....*....................................
        aesr v25.16b, v12.16b                // ....*....................................
        aesr v1.16b, v12.16b                 // ....*....................................
        ldp q30, q3, [x0, #48]               // ....*....................................
        extr x22, x12, x12, #32              // ....*....................................
        extr x3, x12, x6, #63                // ....*....................................
        aesr v26.16b, v12.16b                // .....*...................................
        aesr v24.16b, v12.16b                // .....*...................................
        csel x14, xzr, x15, gt               // .....*...................................
        ldp q2, q31, [x0], #0x50             // .....*...................................
        and w13, w19, w22, asr #31           // .....*...................................
        extr x22, x3, x3, #32                // .....*...................................
        aesr v0.16b, v13.16b                 // ......*..................................
        aesr v25.16b, v13.16b                // ......*..................................
        ldr q29, [x0, #-48]                  // ......*..................................
        aesr v1.16b, v13.16b                 // ......*..................................
        eor x16, x13, x6, lsl #1             // ......*..................................
        and w13, w19, w22, asr #31           // ......*..................................
        aesr v26.16b, v13.16b                // .......*.................................
        aesr v24.16b, v13.16b                // .......*.................................
        eor x7, x13, x16, lsl #1             // .......*.................................
        extr x4, x3, x16, #63                // .......*.................................
        aesr v0.16b, v14.16b                 // ........*................................
        aesr v25.16b, v14.16b                // ........*................................
        aesr v1.16b, v14.16b                 // ........*................................
        extr x22, x4, x4, #32                // ........*................................
        extr x10, x4, x7, #63                // ........*................................
        aesr v26.16b, v14.16b                // .........*...............................
        aesr v24.16b, v14.16b                // .........*...............................
        and w13, w19, w22, asr #31           // .........*...............................
        aesr v0.16b, v15.16b                 // ..........*..............................
        aesr v25.16b, v15.16b                // ..........*..............................
        aesr v1.16b, v15.16b                 // ..........*..............................
        eor x9, x13, x7, lsl #1              // ..........*..............................
        aesr v26.16b, v15.16b                // ...........*.............................
        aesr v24.16b, v15.16b                // ...........*.............................
        aesr v0.16b, v4.16b                  // ............*............................
        aesr v25.16b, v4.16b                 // ............*............................
        aesr v1.16b, v4.16b                  // ............*............................
        aesr v26.16b, v4.16b                 // .............*...........................
        aesr v24.16b, v4.16b                 // .............*...........................
        aesr v0.16b, v5.16b                  // ..............*..........................
        aesr v25.16b, v5.16b                 // ..............*..........................
        aesr v1.16b, v5.16b                  // ..............*..........................
        aesr v26.16b, v5.16b                 // ...............*.........................
        aesr v24.16b, v5.16b                 // ...............*.........................
        aesr v0.16b, v18.16b                 // ................*........................
        aesr v25.16b, v18.16b                // ................*........................
        aesr v1.16b, v18.16b                 // ................*........................
        aesr v26.16b, v18.16b                // .................*.......................
        aesr v24.16b, v18.16b                // .................*.......................
        aesr v0.16b, v19.16b                 // ..................*......................
        aesr v25.16b, v19.16b                // ..................*......................
        aesr v1.16b, v19.16b                 // ..................*......................
        aesr v26.16b, v19.16b                // ...................*.....................
        aesr v24.16b, v19.16b                // ...................*.....................
        aesr v0.16b, v20.16b                 // ....................*....................
        aesr v25.16b, v20.16b                // ....................*....................
        aesr v1.16b, v20.16b                 // ....................*....................
        aesr v26.16b, v20.16b                // .....................*...................
        aesr v24.16b, v20.16b                // .....................*...................
        aesr v0.16b, v21.16b                 // ......................*..................
        aesr v25.16b, v21.16b                // ......................*..................
        aesr v1.16b, v21.16b                 // ......................*..................
        aesr v26.16b, v21.16b                // .......................*.................
        aesr v24.16b, v21.16b                // .......................*.................
        aesr v0.16b, v22.16b                 // ........................*................
        aesr v25.16b, v22.16b                // ........................*................
        aesr v1.16b, v22.16b                 // ........................*................
        aesr v26.16b, v22.16b                // .........................*...............
        aesr v24.16b, v22.16b                // .........................*...............
        aese v0.16b, v23.16b                 // ..........................*..............
        aese v25.16b, v23.16b                // ..........................*..............
        aese v1.16b, v23.16b                 // ..........................*..............
        aese v26.16b, v23.16b                // ...........................*.............
        aese v24.16b, v23.16b                // ...........................*.............
        eor v27.16B, v0.16B, v7.16B          // ............................*............
        eor v0.16B, v25.16B, v7.16B          // ............................*............
        eor v25.16B, v1.16B, v7.16B          // ............................*............
        eor v26.16B, v26.16B, v7.16B         // .............................*...........
        eor v1.16B, v24.16B, v7.16B          // .............................*...........
        eor v28.16B, v0.16B, v10.16B         // ..............................*..........
        eor v24.16B, v27.16B, v6.16B         // ..............................*..........
        eor v0.16B, v25.16B, v8.16B          // ..............................*..........
        fmov d10, x7                         // ..............................*..........
        eor v25.16B, v26.16B, v11.16B        // ...............................*.........
        eor v27.16B, v1.16B, v9.16B          // ...............................*.........
        fmov d6, x17                         // ...............................*.........
        fmov d8, x6                          // ...............................*.........
        fmov d9, x16                         // ................................*........
        stp q24, q0, [x1], #0x50             // ................................*........
        fmov d11, x9                         // ................................*........
        fmov v10.d[1], x4                    // .................................*.......
        str q25, [x1, #-16]                  // .................................*.......
        fmov v6.d[1], x11                    // ..................................*......
        fmov v8.d[1], x12                    // ..................................*......
        stp q27, q28, [x1, #-48]             // ..................................*......
        fmov v9.d[1], x3                     // ...................................*.....
        fmov v11.d[1], x10                   // ...................................*.....
        eor v25.16B, v30.16B, v10.16B        // ....................................*....
        eor v0.16B, v2.16B, v6.16B           // .....................................*...
        eor v26.16B, v3.16B, v11.16B         // ......................................*..
        aesr v25.16b, v16.16b                // ......................................*..
        aesr v0.16b, v16.16b                 // .......................................*.
        aesr v25.16b, v17.16b                // ........................................*

                                                            // ----------- cycle (expected) ----------->
                                                            // 0                        25
                                                            // |------------------------|---------------
        // subs X<ssa_11>, x2, #0x50                        // .*.......................................
        // csel X<ssa_19>, xzr, X<ssa_11>, gt               // ..*......................................
        // aesr v25.16b, v16.16b                            // *........................................
        // aesr v25.16b, v17.16b                            // ..*......................................
        // aesr v0.16b, v16.16b                             // *........................................
        // aesr v25.16b, v12.16b                            // ....*....................................
        // extr x22, x10, x10, #32                          // *........................................
        // aesr v26.16b, v16.16b                            // *........................................
        // and W<ssa_44>, w19, w22, asr #31                 // .*.......................................
        // aesr v0.16b, v17.16b                             // ..*......................................
        // aesr v26.16b, v17.16b                            // ...*.....................................
        // eor X<ssa_46>, X<ssa_44>, x9, lsl #1             // ..*......................................
        // aesr v25.16b, v13.16b                            // ......*..................................
        // aesr v1.16b, v16.16b                             // *........................................
        // extr X<ssa_48>, x10, x9, #63                     // *........................................
        // aesr v0.16b, v12.16b                             // ....*....................................
        // aesr v24.16b, v16.16b                            // .*.......................................
        // aesr v25.16b, v14.16b                            // ........*................................
        // aesr v26.16b, v12.16b                            // .....*...................................
        // extr X<ssa_49>, X<ssa_48>, X<ssa_46>, #63        // ...*.....................................
        // aesr v0.16b, v13.16b                             // ......*..................................
        // aesr v1.16b, v17.16b                             // ..*......................................
        // extr x22, X<ssa_48>, X<ssa_48>, #32              // .*.......................................
        // aesr v26.16b, v13.16b                            // .......*.................................
        // aesr v25.16b, v15.16b                            // ..........*..............................
        // and W<ssa_50>, w19, w22, asr #31                 // ..*......................................
        // aesr v24.16b, v17.16b                            // ...*.....................................
        // aesr v0.16b, v14.16b                             // ........*................................
        // aesr v1.16b, v12.16b                             // ....*....................................
        // eor X<ssa_51>, X<ssa_50>, X<ssa_46>, lsl #1      // ...*.....................................
        // extr x22, X<ssa_49>, X<ssa_49>, #32              // ....*....................................
        // aesr v25.16b, v4.16b                             // ............*............................
        // aesr v24.16b, v12.16b                            // .....*...................................
        // and W<ssa_52>, w19, w22, asr #31                 // .....*...................................
        // aesr v26.16b, v14.16b                            // .........*...............................
        // extr X<ssa_53>, X<ssa_49>, X<ssa_51>, #63        // ....*....................................
        // aesr v0.16b, v15.16b                             // ..........*..............................
        // aesr v1.16b, v13.16b                             // ......*..................................
        // eor X<ssa_54>, X<ssa_52>, X<ssa_51>, lsl #1      // ......*..................................
        // extr x22, X<ssa_53>, X<ssa_53>, #32              // .....*...................................
        // aesr v26.16b, v15.16b                            // ...........*.............................
        // aesr v24.16b, v13.16b                            // .......*.................................
        // subs X<ssa_55>, x2, #0x50                        // ...*.....................................
        // aesr v25.16b, v5.16b                             // ..............*..........................
        // and W<ssa_57>, w19, w22, asr #31                 // ......*..................................
        // aesr v0.16b, v4.16b                              // ............*............................
        // eor X<ssa_58>, X<ssa_57>, X<ssa_54>, lsl #1      // .......*.................................
        // aesr v1.16b, v14.16b                             // ........*................................
        // aesr v25.16b, v18.16b                            // ................*........................
        // aesr v24.16b, v14.16b                            // .........*...............................
        // extr X<ssa_59>, X<ssa_53>, X<ssa_54>, #63        // .......*.................................
        // aesr v26.16b, v4.16b                             // .............*...........................
        // aesr v0.16b, v5.16b                              // ..............*..........................
        // aesr v1.16b, v15.16b                             // ..........*..............................
        // add x0, x0, X<ssa_19>                            // ...*.....................................
        // ldr q29, [x0, #32]                               // ......*..................................
        // aesr v24.16b, v15.16b                            // ...........*.............................
        // aesr v25.16b, v19.16b                            // ..................*......................
        // aesr v26.16b, v5.16b                             // ...............*.........................
        // extr x22, X<ssa_59>, X<ssa_59>, #32              // ........*................................
        // aesr v0.16b, v18.16b                             // ................*........................
        // and W<ssa_60>, w19, w22, asr #31                 // .........*...............................
        // aesr v1.16b, v4.16b                              // ............*............................
        // aesr v24.16b, v4.16b                             // .............*...........................
        // csel x14, xzr, X<ssa_55>, gt                     // .....*...................................
        // aesr v26.16b, v18.16b                            // .................*.......................
        // aesr v25.16b, v20.16b                            // ....................*....................
        // aesr v1.16b, v5.16b                              // ..............*..........................
        // extr x10, X<ssa_59>, X<ssa_58>, #63              // ........*................................
        // aesr v0.16b, v19.16b                             // ..................*......................
        // aesr v25.16b, v21.16b                            // ......................*..................
        // aesr v26.16b, v19.16b                            // ...................*.....................
        // aesr v24.16b, v5.16b                             // ...............*.........................
        // aesr v1.16b, v18.16b                             // ................*........................
        // aesr v0.16b, v20.16b                             // ....................*....................
        // ldp Q<ssa_61>, q31, [x0], #0x50                  // .....*...................................
        // aesr v25.16b, v22.16b                            // ........................*................
        // aesr v24.16b, v18.16b                            // .................*.......................
        // aesr v26.16b, v20.16b                            // .....................*...................
        // aesr v0.16b, v21.16b                             // ......................*..................
        // aesr v1.16b, v19.16b                             // ..................*......................
        // aesr v26.16b, v21.16b                            // .......................*.................
        // aesr v24.16b, v19.16b                            // ...................*.....................
        // aese v25.16b, v23.16b                            // ..........................*..............
        // aesr v1.16b, v20.16b                             // ....................*....................
        // aesr v0.16b, v22.16b                             // ........................*................
        // eor V<ssa_62>.16B, v25.16B, v7.16B               // ............................*............
        // aesr v24.16b, v20.16b                            // .....................*...................
        // aesr v26.16b, v22.16b                            // .........................*...............
        // aesr v1.16b, v21.16b                             // ......................*..................
        // aese v0.16b, v23.16b                             // ..........................*..............
        // eor V<ssa_63>.16B, V<ssa_62>.16B, v10.16B        // ..............................*..........
        // aese v26.16b, v23.16b                            // ...........................*.............
        // aesr v24.16b, v21.16b                            // .......................*.................
        // fmov d10, X<ssa_58>                              // ..............................*..........
        // eor x9, X<ssa_60>, X<ssa_58>, lsl #1             // ..........*..............................
        // aesr v1.16b, v22.16b                             // ........................*................
        // eor V<ssa_64>.16B, v0.16B, v7.16B                // ............................*............
        // eor V<ssa_65>.16B, v26.16B, v7.16B               // .............................*...........
        // aesr v24.16b, v22.16b                            // .........................*...............
        // ldp Q<ssa_66>, Q<ssa_67>, [x0, #-32]             // ....*....................................
        // aese v1.16b, v23.16b                             // ..........................*..............
        // fmov v10.d[1], X<ssa_59>                         // .................................*.......
        // eor V<ssa_68>.16B, V<ssa_64>.16B, v6.16B         // ..............................*..........
        // fmov d6, X<ssa_46>                               // ...............................*.........
        // aese v24.16b, v23.16b                            // ...........................*.............
        // eor V<ssa_69>.16B, V<ssa_65>.16B, v11.16B        // ...............................*.........
        // fmov d11, x9                                     // ................................*........
        // eor V<ssa_70>.16B, v1.16B, v7.16B                // ............................*............
        // eor V<ssa_71>.16B, v24.16B, v7.16B               // .............................*...........
        // fmov v6.d[1], X<ssa_48>                          // ..................................*......
        // eor v25.16B, V<ssa_66>.16B, v10.16B              // ....................................*....
        // eor V<ssa_72>.16B, V<ssa_70>.16B, v8.16B         // ..............................*..........
        // fmov v11.d[1], x10                               // ...................................*.....
        // fmov d8, X<ssa_51>                               // ...............................*.........
        // aesr v25.16b, v16.16b                            // ......................................*..
        // eor V<ssa_73>.16B, V<ssa_71>.16B, v9.16B         // ...............................*.........
        // fmov d9, X<ssa_54>                               // ................................*........
        // stp Q<ssa_68>, Q<ssa_72>, [x1], #0x50            // ................................*........
        // eor v0.16B, V<ssa_61>.16B, v6.16B                // .....................................*...
        // aesr v25.16b, v17.16b                            // ........................................*
        // str Q<ssa_69>, [x1, #-16]                        // .................................*.......
        // eor v26.16B, V<ssa_67>.16B, v11.16B              // ......................................*..
        // fmov v8.d[1], X<ssa_49>                          // ..................................*......
        // aesr v0.16b, v16.16b                             // .......................................*.
        // fmov v9.d[1], X<ssa_53>                          // ...................................*.....
        // stp Q<ssa_73>, Q<ssa_63>, [x1, #-48]             // ..................................*......

        sub x2, x2, #160
Loop5x_xts_enc:
                                             // Instructions:    124
                                             // Expected cycles: 38
                                             // Expected IPC:    3.26
                                             //
                                             // Cycle bound:     38.0
                                             // IPC bound:       3.26
                                             //
                                             // Wall time:     5.84s
                                             // User time:     5.84s
                                             //
                                             // --------- cycle (expected) ---------->
                                             // 0                        25
                                             // |------------------------|------------
        aesr v25.16b, v12.16b                // *.....................................
        extr x22, x10, x10, #32              // *.....................................
        aesr v26.16b, v16.16b                // *.....................................
        and w11, w19, w22, asr #31           // .*....................................
        eor v1.16B, v31.16B, v8.16B          // .l....................................
        aesr v0.16b, v17.16b                 // .*....................................
        aesr v26.16b, v17.16b                // ..*...................................
        eor x4, x11, x9, lsl #1              // ..*...................................
        eor v24.16B, v29.16B, v9.16B         // ..l...................................
        aesr v25.16b, v13.16b                // ..*...................................
        aesr v1.16b, v16.16b                 // ...*..................................
        extr x17, x10, x9, #63               // ...*..................................
        aesr v0.16b, v12.16b                 // ...*..................................
        aesr v24.16b, v16.16b                // ....*.................................
        aesr v25.16b, v14.16b                // ....*.................................
        aesr v26.16b, v12.16b                // ....*.................................
        extr x13, x17, x4, #63               // ....*.................................
        aesr v0.16b, v13.16b                 // .....*................................
        aesr v1.16b, v17.16b                 // .....*................................
        extr x22, x17, x17, #32              // .....*................................
        aesr v26.16b, v13.16b                // ......*...............................
        aesr v25.16b, v15.16b                // ......*...............................
        and w9, w19, w22, asr #31            // ......*...............................
        aesr v24.16b, v17.16b                // ......*...............................
        aesr v0.16b, v14.16b                 // .......*..............................
        aesr v1.16b, v12.16b                 // .......*..............................
        eor x3, x9, x4, lsl #1               // .......*..............................
        extr x22, x13, x13, #32              // .......*..............................
        aesr v25.16b, v4.16b                 // ........*.............................
        aesr v24.16b, v12.16b                // ........*.............................
        and w15, w19, w22, asr #31           // ........*.............................
        aesr v26.16b, v14.16b                // ........*.............................
        extr x6, x13, x3, #63                // ........*.............................
        aesr v0.16b, v15.16b                 // .........*............................
        aesr v1.16b, v13.16b                 // .........*............................
        eor x11, x15, x3, lsl #1             // .........*............................
        extr x22, x6, x6, #32                // .........*............................
        aesr v26.16b, v15.16b                // ..........*...........................
        aesr v24.16b, v13.16b                // ..........*...........................
        subs x10, x2, #0x50                  // ..........e...........................
        aesr v25.16b, v5.16b                 // ..........*...........................
        and w9, w19, w22, asr #31            // ..........*...........................
        aesr v0.16b, v4.16b                  // ...........*..........................
        eor x9, x9, x11, lsl #1              // ...........*..........................
        aesr v1.16b, v14.16b                 // ...........*..........................
        aesr v25.16b, v18.16b                // ............*.........................
        aesr v24.16b, v14.16b                // ............*.........................
        extr x12, x6, x11, #63               // ............*.........................
        aesr v26.16b, v4.16b                 // ............*.........................
        aesr v0.16b, v5.16b                  // .............*........................
        aesr v1.16b, v15.16b                 // .............*........................
        add x0, x0, x14                      // .............*........................
        ldr q29, [x0, #32]                   // ..............*.......................
        aesr v24.16b, v15.16b                // ..............*.......................
        aesr v25.16b, v19.16b                // ..............*.......................
        aesr v26.16b, v5.16b                 // ..............*.......................
        extr x22, x12, x12, #32              // ..............*.......................
        aesr v0.16b, v18.16b                 // ...............*......................
        and w15, w19, w22, asr #31           // ...............*......................
        aesr v1.16b, v4.16b                  // ...............*......................
        aesr v24.16b, v4.16b                 // ................*.....................
        csel x14, xzr, x10, gt               // ................e.....................
        aesr v26.16b, v18.16b                // ................*.....................
        aesr v25.16b, v20.16b                // ................*.....................
        aesr v1.16b, v5.16b                  // .................*....................
        extr x10, x12, x9, #63               // .................*....................
        aesr v0.16b, v19.16b                 // .................*....................
        aesr v25.16b, v21.16b                // ..................*...................
        aesr v26.16b, v19.16b                // ..................*...................
        aesr v24.16b, v5.16b                 // ..................*...................
        aesr v1.16b, v18.16b                 // ...................*..................
        aesr v0.16b, v20.16b                 // ...................*..................
        ldp q30, q31, [x0], #0x50            // ....................*.................
        aesr v25.16b, v22.16b                // ....................*.................
        aesr v24.16b, v18.16b                // ....................*.................
        aesr v26.16b, v20.16b                // ....................*.................
        aesr v0.16b, v21.16b                 // .....................*................
        aesr v1.16b, v19.16b                 // .....................*................
        aesr v26.16b, v21.16b                // ......................*...............
        aesr v24.16b, v19.16b                // ......................*...............
        aese v25.16b, v23.16b                // ......................*...............
        aesr v1.16b, v20.16b                 // .......................*..............
        aesr v0.16b, v22.16b                 // .......................*..............
        eor v28.16B, v25.16B, v7.16B         // ........................*.............
        aesr v24.16b, v20.16b                // ........................*.............
        aesr v26.16b, v22.16b                // ........................*.............
        aesr v1.16b, v21.16b                 // .........................*............
        aese v0.16b, v23.16b                 // .........................*............
        eor v3.16B, v28.16B, v10.16B         // ..........................*...........
        aese v26.16b, v23.16b                // ..........................*...........
        aesr v24.16b, v21.16b                // ..........................*...........
        fmov d10, x9                         // ..........................*...........
        eor x9, x15, x9, lsl #1              // ..........................*...........
        aesr v1.16b, v22.16b                 // ...........................*..........
        eor v0.16B, v0.16B, v7.16B           // ...........................*..........
        eor v28.16B, v26.16B, v7.16B         // ............................*.........
        aesr v24.16b, v22.16b                // ............................*.........
        ldp q2, q26, [x0, #-32]              // ............................*.........
        aese v1.16b, v23.16b                 // .............................*........
        fmov v10.d[1], x12                   // .............................*........
        eor v27.16B, v0.16B, v6.16B          // .............................*........
        fmov d6, x4                          // .............................*........
        aese v24.16b, v23.16b                // ..............................*.......
        eor v28.16B, v28.16B, v11.16B        // ..............................*.......
        fmov d11, x9                         // ..............................*.......
        eor v1.16B, v1.16B, v7.16B           // ...............................*......
        eor v0.16B, v24.16B, v7.16B          // ................................*.....
        fmov v6.d[1], x17                    // ................................*.....
        eor v25.16B, v2.16B, v10.16B         // ................................*.....
        eor v2.16B, v1.16B, v8.16B           // .................................*....
        fmov v11.d[1], x10                   // .................................*....
        fmov d8, x3                          // .................................*....
        aesr v25.16b, v16.16b                // ..................................e...
        eor v24.16B, v0.16B, v9.16B          // ..................................*...
        fmov d9, x11                         // ..................................*...
        stp q27, q2, [x1], #0x50             // ...................................*..
        eor v0.16B, v30.16B, v6.16B          // ...................................*..
        aesr v25.16b, v17.16b                // ....................................e.
        str q28, [x1, #-16]                  // ....................................*.
        eor v26.16B, v26.16B, v11.16B        // ....................................*.
        fmov v8.d[1], x13                    // ....................................*.
        aesr v0.16b, v16.16b                 // .....................................e
        fmov v9.d[1], x6                     // .....................................*
        stp q24, q3, [x1, #-48]              // .....................................*

                                            // ------------------------- cycle (expected) ------------------------->
                                            // 0                        25                       50
                                            // |------------------------|------------------------|------------------
        // aesr    v0.16b, v16.16b          // ...........................e'....................................~'..
        // aesr    v1.16b, v16.16b          // ............................'..*..................................'..
        // aesr    v24.16b, v16.16b         // ............................'...*.................................'..
        // aesr    v25.16b, v16.16b         // ........................e...'.................................~...'..
        // aesr    v26.16b, v16.16b         // ............................*.....................................~..
        // subs x12,x2,#0x50                // e...........................'.........~...........................'..
        // aesr    v0.16b, v17.16b          // ............................'*....................................'~.
        // aesr    v1.16b, v17.16b          // ............................'....*................................'..
        // aesr    v24.16b, v17.16b         // ............................'.....*...............................'..
        // aesr    v25.16b, v17.16b         // ..........................e.'...................................~.'..
        // aesr    v26.16b, v17.16b         // ............................'.*...................................'..
        // csel x6,xzr,x12,gt               // ......e.....................'...............~.....................'..
        // aesr    v0.16b, v12.16b          // ............................'..*..................................'..
        // aesr    v1.16b, v12.16b          // ............................'......*..............................'..
        // aesr    v24.16b, v12.16b         // ............................'.......*.............................'..
        // aesr    v25.16b, v12.16b         // ............................*.....................................~..
        // aesr    v26.16b, v12.16b         // ............................'...*.................................'..
        // aesr    v0.16b, v13.16b          // ............................'....*................................'..
        // aesr    v1.16b, v13.16b          // ............................'........*............................'..
        // aesr    v24.16b, v13.16b         // ~...........................'.........*...........................'..
        // aesr    v25.16b, v13.16b         // ............................'.*...................................'..
        // aesr    v26.16b, v13.16b         // ............................'.....*...............................'..
        // aesr    v0.16b, v14.16b          // ............................'......*..............................'..
        // aesr    v1.16b, v14.16b          // .~..........................'..........*..........................'..
        // aesr    v24.16b, v14.16b         // ..~.........................'...........*.........................'..
        // aesr    v25.16b, v14.16b         // ............................'...*.................................'..
        // aesr    v26.16b, v14.16b         // ............................'.......*.............................'..
        // aesr    v0.16b, v15.16b          // ............................'........*............................'..
        // aesr    v1.16b, v15.16b          // ...~........................'............*........................'..
        // aesr    v24.16b, v15.16b         // ....~.......................'.............*.......................'..
        // aesr    v25.16b, v15.16b         // ............................'.....*...............................'..
        // aesr    v26.16b, v15.16b         // ~...........................'.........*...........................'..
        // aesr    v0.16b, v4.16b           // .~..........................'..........*..........................'..
        // aesr    v1.16b, v4.16b           // .....~......................'..............*......................'..
        // aesr    v24.16b, v4.16b          // ......~.....................'...............*.....................'..
        // aesr    v25.16b, v4.16b          // ............................'.......*.............................'..
        // aesr    v26.16b, v4.16b          // ..~.........................'...........*.........................'..
        // aesr    v0.16b, v5.16b           // ...~........................'............*........................'..
        // aesr    v1.16b, v5.16b           // .......~....................'................*....................'..
        // aesr    v24.16b, v5.16b          // ........~...................'.................*...................'..
        // aesr    v25.16b, v5.16b          // ~...........................'.........*...........................'..
        // aesr    v26.16b, v5.16b          // ....~.......................'.............*.......................'..
        // aesr    v0.16b, v18.16b          // .....~......................'..............*......................'..
        // aesr    v1.16b, v18.16b          // .........~..................'..................*..................'..
        // aesr    v24.16b, v18.16b         // ..........~.................'...................*.................'..
        // aesr    v25.16b, v18.16b         // ..~.........................'...........*.........................'..
        // aesr    v26.16b, v18.16b         // ......~.....................'...............*.....................'..
        // add x0,x0,x6                     // ...~........................'............*........................'..
        // aesr    v0.16b, v19.16b          // .......~....................'................*....................'..
        // aesr    v1.16b, v19.16b          // ...........~................'....................*................'..
        // aesr    v24.16b, v19.16b         // ............~...............'.....................*...............'..
        // aesr    v25.16b, v19.16b         // ....~.......................'.............*.......................'..
        // aesr    v26.16b, v19.16b         // ........~...................'.................*...................'..
        // aesr    v0.16b, v20.16b          // .........~..................'..................*..................'..
        // aesr    v1.16b, v20.16b          // .............~..............'......................*..............'..
        // aesr    v24.16b, v20.16b         // ..............~.............'.......................*.............'..
        // aesr    v25.16b, v20.16b         // ......~.....................'...............*.....................'..
        // aesr    v26.16b, v20.16b         // ..........~.................'...................*.................'..
        // aesr    v0.16b, v21.16b          // ...........~................'....................*................'..
        // aesr    v1.16b, v21.16b          // ...............~............'........................*............'..
        // aesr    v24.16b, v21.16b         // ................~...........'.........................*...........'..
        // aesr    v25.16b, v21.16b         // ........~...................'.................*...................'..
        // aesr    v26.16b, v21.16b         // ............~...............'.....................*...............'..
        // aesr    v0.16b, v22.16b          // .............~..............'......................*..............'..
        // aesr    v1.16b, v22.16b          // .................~..........'..........................*..........'..
        // aesr    v24.16b, v22.16b         // ..................~.........'...........................*.........'..
        // aesr    v25.16b, v22.16b         // ..........~.................'...................*.................'..
        // aesr    v26.16b, v22.16b         // ..............~.............'.......................*.............'..
        // aese v0.16b,v23.16b              // ...............~............'........................*............'..
        // aese v1.16b,v23.16b              // ...................~........'............................*........'..
        // aese v24.16b,v23.16b             // ....................~.......'.............................*.......'..
        // aese v25.16b,v23.16b             // ............~...............'.....................*...............'..
        // aese v26.16b,v23.16b             // ................~...........'.........................*...........'..
        // eor v0.16b,v0.16b,v7.16b         // .................~..........'..........................*..........'..
        // eor v0.16b,v0.16b,v6.16b         // ...................~........'............................*........'..
        // extr x22,x10,x10,#32             // ............................*.....................................~..
        // extr x10,x10,x9,#63              // ............................'..*..................................'..
        // and w11,w19,w22,asr#31           // ............................'*....................................'~.
        // eor x9,x11,x9,lsl#1              // ............................'.*...................................'..
        // fmov d6,x9                       // ...................~........'............................*........'..
        // fmov v6.d[1],x10                 // ......................~.....'...............................*.....'..
        // eor v1.16b,v1.16b,v7.16b         // .....................~......'..............................*......'..
        // eor v1.16b,v1.16b,v8.16b         // .......................~....'................................*....'..
        // ldp q2, q3, [x0], #0x50          // ..........~.................'...................*.................'..
        // extr x22,x10,x10,#32             // ............................'....*................................'..
        // extr x10,x10,x9,#63              // ............................'...*.................................'..
        // and w11,w19,w22,asr#31           // ............................'.....*...............................'..
        // eor x9,x11,x9,lsl#1              // ............................'......*..............................'..
        // fmov d8,x9                       // .......................~....'................................*....'..
        // fmov v8.d[1],x10                 // ..........................~.'...................................*.'..
        // eor v24.16b,v24.16b,v7.16b       // ......................~.....'...............................*.....'..
        // eor v24.16b,v24.16b,v9.16b       // ........................~...'.................................*...'..
        // extr x22,x10,x10,#32             // ............................'......*..............................'..
        // extr x10,x10,x9,#63              // ............................'.......*.............................'..
        // and w11,w19,w22,asr#31           // ............................'.......*.............................'..
        // eor x9,x11,x9,lsl#1              // ............................'........*............................'..
        // fmov d9,x9                       // ........................~...'.................................*...'..
        // fmov v9.d[1],x10                 // ...........................~'....................................*'..
        // eor v25.16b,v25.16b,v7.16b       // ..............~.............'.......................*.............'..
        // eor v25.16b,v25.16b,v10.16b      // ................~...........'.........................*...........'..
        // ldr q27, [x0, #-0x30]            // ....~.......................'.............*.......................'..
        // extr x22,x10,x10,#32             // ............................'........*............................'..
        // extr x10,x10,x9,#63              // ..~.........................'...........*.........................'..
        // and w11,w19,w22,asr#31           // ~...........................'.........*...........................'..
        // eor x9,x11,x9,lsl#1              // .~..........................'..........*..........................'..
        // fmov d10,x9                      // ................~...........'.........................*...........'..
        // fmov v10.d[1],x10                // ...................~........'............................*........'..
        // eor v26.16b,v26.16b,v7.16b       // ..................~.........'...........................*.........'..
        // eor v26.16b,v26.16b,v11.16b      // ....................~.......'.............................*.......'..
        // ldp q28, q29,[x0, #-0x20]        // ..................~.........'...........................*.........'..
        // extr x22,x10,x10,#32             // ....~.......................'.............*.......................'..
        // extr x10,x10,x9,#63              // .......~....................'................*....................'..
        // and w11,w19,w22,asr #31          // .....~......................'..............*......................'..
        // eor x9,x11,x9,lsl #1             // ................~...........'.........................*...........'..
        // fmov d11,x9                      // ....................~.......'.............................*.......'..
        // fmov v11.d[1],x10                // .......................~....'................................*....'..
        // stp q0, q1, [x1], #0x50          // .........................~..'..................................*..'..
        // stp q24, q25, [x1, #-0x30]       // ...........................~'....................................*'..
        // str q26, [x1, #-0x10]            // ..........................~.'...................................*.'..
        // eor v0.16b,v2.16b,v6.16b         // .........................~..'..................................*..'..
        // eor v1.16b,v3.16b,v8.16b         // ............................'~....................................'l.
        // eor v24.16b,v27.16b,v9.16b       // ............................'.~...................................'.l
        // eor v25.16b,v28.16b,v10.16b      // ......................~.....'...............................*.....'..
        // eor v26.16b,v29.16b,v11.16b      // ..........................~.'...................................*.'..

        subs x2, x2, #0x50
        b.hs Loop5x_xts_enc
                                             // Instructions:    121
                                             // Expected cycles: 39
                                             // Expected IPC:    3.10
                                             //
                                             // Cycle bound:     39.0
                                             // IPC bound:       3.10
                                             //
                                             // Wall time:     0.77s
                                             // User time:     0.77s
                                             //
                                             // ---------- cycle (expected) ---------->
                                             // 0                        25
                                             // |------------------------|-------------
        aesr v0.16b, v17.16b                 // *......................................
        eor v31.16B, v31.16B, v8.16B         // *......................................
        eor v1.16B, v29.16B, v9.16B          // *......................................
        extr x22, x10, x10, #32              // *......................................
        extr x6, x10, x9, #63                // *......................................
        add x0, x0, x14                      // *......................................
        aesr v26.16b, v16.16b                // .*.....................................
        aesr v25.16b, v12.16b                // .*.....................................
        ldp q27, q29, [x0, #48]              // .*.....................................
        ldr q2, [x0, #32]                    // .*.....................................
        and w14, w19, w22, asr #31           // .*.....................................
        extr x22, x6, x6, #32                // .*.....................................
        eor x14, x14, x9, lsl #1             // ..*....................................
        aesr v0.16b, v12.16b                 // ..*....................................
        aesr v31.16b, v16.16b                // ..*....................................
        aesr v1.16b, v16.16b                 // ..*....................................
        and w16, w19, w22, asr #31           // ..*....................................
        aesr v26.16b, v17.16b                // ...*...................................
        aesr v25.16b, v13.16b                // ...*...................................
        eor x16, x16, x14, lsl #1            // ...*...................................
        ldp q28, q3, [x0], #0x50             // ...*...................................
        extr x7, x6, x14, #63                // ...*...................................
        aesr v0.16b, v13.16b                 // ....*..................................
        aesr v31.16b, v17.16b                // ....*..................................
        aesr v1.16b, v17.16b                 // ....*..................................
        extr x22, x7, x7, #32                // ....*..................................
        extr x4, x7, x16, #63                // ....*..................................
        aesr v26.16b, v12.16b                // .....*.................................
        aesr v25.16b, v14.16b                // .....*.................................
        and w10, w19, w22, asr #31           // .....*.................................
        extr x22, x4, x4, #32                // .....*.................................
        aesr v0.16b, v14.16b                 // ......*................................
        aesr v31.16b, v12.16b                // ......*................................
        aesr v1.16b, v12.16b                 // ......*................................
        eor x13, x10, x16, lsl #1            // ......*................................
        and w9, w19, w22, asr #31            // ......*................................
        aesr v26.16b, v13.16b                // .......*...............................
        aesr v25.16b, v15.16b                // .......*...............................
        eor x17, x9, x13, lsl #1             // .......*...............................
        extr x8, x4, x13, #63                // .......*...............................
        aesr v0.16b, v15.16b                 // ........*..............................
        aesr v31.16b, v13.16b                // ........*..............................
        aesr v1.16b, v13.16b                 // ........*..............................
        extr x22, x8, x8, #32                // ........*..............................
        extr x10, x8, x17, #63               // ........*..............................
        aesr v26.16b, v14.16b                // .........*.............................
        aesr v25.16b, v4.16b                 // .........*.............................
        and w5, w19, w22, asr #31            // .........*.............................
        aesr v0.16b, v4.16b                  // ..........*............................
        aesr v31.16b, v14.16b                // ..........*............................
        aesr v1.16b, v14.16b                 // ..........*............................
        eor x9, x5, x17, lsl #1              // ..........*............................
        aesr v26.16b, v15.16b                // ...........*...........................
        aesr v25.16b, v5.16b                 // ...........*...........................
        aesr v0.16b, v5.16b                  // ............*..........................
        aesr v31.16b, v15.16b                // ............*..........................
        aesr v1.16b, v15.16b                 // ............*..........................
        aesr v26.16b, v4.16b                 // .............*.........................
        aesr v25.16b, v18.16b                // .............*.........................
        aesr v0.16b, v18.16b                 // ..............*........................
        aesr v31.16b, v4.16b                 // ..............*........................
        aesr v1.16b, v4.16b                  // ..............*........................
        aesr v26.16b, v5.16b                 // ...............*.......................
        aesr v25.16b, v19.16b                // ...............*.......................
        aesr v0.16b, v19.16b                 // ................*......................
        aesr v31.16b, v5.16b                 // ................*......................
        aesr v1.16b, v5.16b                  // ................*......................
        aesr v26.16b, v18.16b                // .................*.....................
        aesr v25.16b, v20.16b                // .................*.....................
        aesr v0.16b, v20.16b                 // ..................*....................
        aesr v31.16b, v18.16b                // ..................*....................
        aesr v1.16b, v18.16b                 // ..................*....................
        aesr v26.16b, v19.16b                // ...................*...................
        aesr v25.16b, v21.16b                // ...................*...................
        aesr v0.16b, v21.16b                 // ....................*..................
        aesr v31.16b, v19.16b                // ....................*..................
        aesr v1.16b, v19.16b                 // ....................*..................
        aesr v26.16b, v20.16b                // .....................*.................
        aesr v25.16b, v22.16b                // .....................*.................
        aesr v0.16b, v22.16b                 // ......................*................
        aesr v31.16b, v20.16b                // ......................*................
        aesr v1.16b, v20.16b                 // ......................*................
        aesr v26.16b, v21.16b                // .......................*...............
        aese v25.16b, v23.16b                // .......................*...............
        aese v0.16b, v23.16b                 // ........................*..............
        aesr v31.16b, v21.16b                // ........................*..............
        aesr v1.16b, v21.16b                 // ........................*..............
        aesr v26.16b, v22.16b                // .........................*.............
        eor v25.16B, v25.16B, v7.16B         // .........................*.............
        eor v0.16B, v0.16B, v7.16B           // ..........................*............
        aesr v31.16b, v22.16b                // ..........................*............
        aesr v1.16b, v22.16b                 // ..........................*............
        eor v24.16B, v25.16B, v10.16B        // ...........................*...........
        fmov d10, x17                        // ...........................*...........
        aese v26.16b, v23.16b                // ...........................*...........
        eor v30.16B, v0.16B, v6.16B          // ............................*..........
        fmov d6, x14                         // ............................*..........
        aese v31.16b, v23.16b                // ............................*..........
        aese v1.16b, v23.16b                 // ............................*..........
        eor v25.16B, v26.16B, v7.16B         // .............................*.........
        fmov v10.d[1], x8                    // ..............................*........
        eor v0.16B, v31.16B, v7.16B          // ..............................*........
        eor v26.16B, v1.16B, v7.16B          // ..............................*........
        eor v1.16B, v25.16B, v11.16B         // ...............................*.......
        fmov v6.d[1], x6                     // ...............................*.......
        fmov d11, x9                         // ...............................*.......
        eor v31.16B, v26.16B, v9.16B         // ................................*......
        eor v26.16B, v0.16B, v8.16B          // ................................*......
        fmov d8, x16                         // ................................*......
        fmov d9, x13                         // ................................*......
        eor v25.16B, v27.16B, v10.16B        // .................................*.....
        str q1, [x1, #64]                    // .................................*.....
        eor v0.16B, v28.16B, v6.16B          // ..................................*....
        stp q31, q24, [x1, #32]              // ..................................*....
        stp q30, q26, [x1], #0x50            // ..................................*....
        fmov v11.d[1], x10                   // ..................................*....
        fmov v8.d[1], x7                     // ...................................*...
        fmov v9.d[1], x4                     // ...................................*...
        eor v26.16B, v29.16B, v11.16B        // .....................................*.
        eor v24.16B, v2.16B, v9.16B          // ......................................*
        eor v1.16B, v3.16B, v8.16B           // ......................................*

                                                            // ---------- cycle (expected) ---------->
                                                            // 0                        25
                                                            // |------------------------|-------------
        // aesr v25.16b, v12.16b                            // .*.....................................
        // extr x22, x10, x10, #32                          // *......................................
        // aesr v26.16b, v16.16b                            // .*.....................................
        // and W<ssa_0>, w19, w22, asr #31                  // .*.....................................
        // eor V<ssa_1>.16B, v31.16B, v8.16B                // *......................................
        // aesr v0.16b, v17.16b                             // *......................................
        // aesr v26.16b, v17.16b                            // ...*...................................
        // eor X<ssa_2>, X<ssa_0>, x9, lsl #1               // ..*....................................
        // eor V<ssa_3>.16B, v29.16B, v9.16B                // *......................................
        // aesr v25.16b, v13.16b                            // ...*...................................
        // aesr V<ssa_1>.16b, v16.16b                       // ..*....................................
        // extr X<ssa_4>, x10, x9, #63                      // *......................................
        // aesr v0.16b, v12.16b                             // ..*....................................
        // aesr V<ssa_3>.16b, v16.16b                       // ..*....................................
        // aesr v25.16b, v14.16b                            // .....*.................................
        // aesr v26.16b, v12.16b                            // .....*.................................
        // extr X<ssa_5>, X<ssa_4>, X<ssa_2>, #63           // ...*...................................
        // aesr v0.16b, v13.16b                             // ....*..................................
        // aesr V<ssa_1>.16b, v17.16b                       // ....*..................................
        // extr x22, X<ssa_4>, X<ssa_4>, #32                // .*.....................................
        // aesr v26.16b, v13.16b                            // .......*...............................
        // aesr v25.16b, v15.16b                            // .......*...............................
        // and W<ssa_6>, w19, w22, asr #31                  // ..*....................................
        // aesr V<ssa_3>.16b, v17.16b                       // ....*..................................
        // aesr v0.16b, v14.16b                             // ......*................................
        // aesr V<ssa_1>.16b, v12.16b                       // ......*................................
        // eor X<ssa_7>, X<ssa_6>, X<ssa_2>, lsl #1         // ...*...................................
        // extr x22, X<ssa_5>, X<ssa_5>, #32                // ....*..................................
        // aesr v25.16b, v4.16b                             // .........*.............................
        // aesr V<ssa_3>.16b, v12.16b                       // ......*................................
        // and W<ssa_8>, w19, w22, asr #31                  // .....*.................................
        // aesr v26.16b, v14.16b                            // .........*.............................
        // extr X<ssa_9>, X<ssa_5>, X<ssa_7>, #63           // ....*..................................
        // aesr v0.16b, v15.16b                             // ........*..............................
        // aesr V<ssa_1>.16b, v13.16b                       // ........*..............................
        // eor X<ssa_10>, X<ssa_8>, X<ssa_7>, lsl #1        // ......*................................
        // extr x22, X<ssa_9>, X<ssa_9>, #32                // .....*.................................
        // aesr v26.16b, v15.16b                            // ...........*...........................
        // aesr V<ssa_3>.16b, v13.16b                       // ........*..............................
        // aesr v25.16b, v5.16b                             // ...........*...........................
        // and W<ssa_13>, w19, w22, asr #31                 // ......*................................
        // aesr v0.16b, v4.16b                              // ..........*............................
        // eor X<ssa_14>, X<ssa_13>, X<ssa_10>, lsl #1      // .......*...............................
        // aesr V<ssa_1>.16b, v14.16b                       // ..........*............................
        // aesr v25.16b, v18.16b                            // .............*.........................
        // aesr V<ssa_3>.16b, v14.16b                       // ..........*............................
        // extr X<ssa_15>, X<ssa_9>, X<ssa_10>, #63         // .......*...............................
        // aesr v26.16b, v4.16b                             // .............*.........................
        // aesr v0.16b, v5.16b                              // ............*..........................
        // aesr V<ssa_1>.16b, v15.16b                       // ............*..........................
        // add x0, x0, x14                                  // *......................................
        // ldr Q<ssa_17>, [x0, #32]                         // .*.....................................
        // aesr V<ssa_3>.16b, v15.16b                       // ............*..........................
        // aesr v25.16b, v19.16b                            // ...............*.......................
        // aesr v26.16b, v5.16b                             // ...............*.......................
        // extr x22, X<ssa_15>, X<ssa_15>, #32              // ........*..............................
        // aesr v0.16b, v18.16b                             // ..............*........................
        // and W<ssa_18>, w19, w22, asr #31                 // .........*.............................
        // aesr V<ssa_1>.16b, v4.16b                        // ..............*........................
        // aesr V<ssa_3>.16b, v4.16b                        // ..............*........................
        // aesr v26.16b, v18.16b                            // .................*.....................
        // aesr v25.16b, v20.16b                            // .................*.....................
        // aesr V<ssa_1>.16b, v5.16b                        // ................*......................
        // extr x10, X<ssa_15>, X<ssa_14>, #63              // ........*..............................
        // aesr v0.16b, v19.16b                             // ................*......................
        // aesr v25.16b, v21.16b                            // ...................*...................
        // aesr v26.16b, v19.16b                            // ...................*...................
        // aesr V<ssa_3>.16b, v5.16b                        // ................*......................
        // aesr V<ssa_1>.16b, v18.16b                       // ..................*....................
        // aesr v0.16b, v20.16b                             // ..................*....................
        // ldp Q<ssa_21>, Q<ssa_22>, [x0], #0x50            // ...*...................................
        // aesr v25.16b, v22.16b                            // .....................*.................
        // aesr V<ssa_3>.16b, v18.16b                       // ..................*....................
        // aesr v26.16b, v20.16b                            // .....................*.................
        // aesr v0.16b, v21.16b                             // ....................*..................
        // aesr V<ssa_1>.16b, v19.16b                       // ....................*..................
        // aesr v26.16b, v21.16b                            // .......................*...............
        // aesr V<ssa_3>.16b, v19.16b                       // ....................*..................
        // aese v25.16b, v23.16b                            // .......................*...............
        // aesr V<ssa_1>.16b, v20.16b                       // ......................*................
        // aesr v0.16b, v22.16b                             // ......................*................
        // eor V<ssa_23>.16B, v25.16B, v7.16B               // .........................*.............
        // aesr V<ssa_3>.16b, v20.16b                       // ......................*................
        // aesr v26.16b, v22.16b                            // .........................*.............
        // aesr V<ssa_1>.16b, v21.16b                       // ........................*..............
        // aese v0.16b, v23.16b                             // ........................*..............
        // eor V<ssa_24>.16B, V<ssa_23>.16B, v10.16B        // ...........................*...........
        // aese v26.16b, v23.16b                            // ...........................*...........
        // aesr V<ssa_3>.16b, v21.16b                       // ........................*..............
        // fmov d10, X<ssa_14>                              // ...........................*...........
        // eor x9, X<ssa_18>, X<ssa_14>, lsl #1             // ..........*............................
        // aesr V<ssa_1>.16b, v22.16b                       // ..........................*............
        // eor V<ssa_27>.16B, v0.16B, v7.16B                // ..........................*............
        // eor V<ssa_28>.16B, v26.16B, v7.16B               // .............................*.........
        // aesr V<ssa_3>.16b, v22.16b                       // ..........................*............
        // ldp Q<ssa_29>, Q<ssa_30>, [x0, #-32]             // .*.....................................
        // aese V<ssa_1>.16b, v23.16b                       // ............................*..........
        // fmov v10.d[1], X<ssa_15>                         // ..............................*........
        // eor V<ssa_31>.16B, V<ssa_27>.16B, v6.16B         // ............................*..........
        // fmov d6, X<ssa_2>                                // ............................*..........
        // aese V<ssa_3>.16b, v23.16b                       // ............................*..........
        // eor V<ssa_33>.16B, V<ssa_28>.16B, v11.16B        // ...............................*.......
        // fmov d11, x9                                     // ...............................*.......
        // eor V<ssa_35>.16B, V<ssa_1>.16B, v7.16B          // ..............................*........
        // eor V<ssa_36>.16B, V<ssa_3>.16B, v7.16B          // ..............................*........
        // fmov v6.d[1], X<ssa_4>                           // ...............................*.......
        // eor v25.16B, V<ssa_29>.16B, v10.16B              // .................................*.....
        // eor V<ssa_38>.16B, V<ssa_35>.16B, v8.16B         // ................................*......
        // fmov v11.d[1], x10                               // ..................................*....
        // fmov d8, X<ssa_7>                                // ................................*......
        // eor V<ssa_40>.16B, V<ssa_36>.16B, v9.16B         // ................................*......
        // fmov d9, X<ssa_10>                               // ................................*......
        // stp Q<ssa_31>, Q<ssa_38>, [x1], #0x50            // ..................................*....
        // eor v0.16B, V<ssa_21>.16B, v6.16B                // ..................................*....
        // str Q<ssa_33>, [x1, #-16]                        // .................................*.....
        // eor v26.16B, V<ssa_30>.16B, v11.16B              // .....................................*.
        // fmov v8.d[1], X<ssa_5>                           // ...................................*...
        // fmov v9.d[1], X<ssa_9>                           // ...................................*...
        // stp Q<ssa_40>, Q<ssa_24>, [x1, #-48]             // ..................................*....
        // eor v1.16B, V<ssa_22>.16B, v8.16B                // ......................................*
        // eor v24.16B, V<ssa_17>.16B, v9.16B               // ......................................*



    // If left 4 blocks, continue from Lxts_enc_tail4x.
    // Otherwise, continue processing
    // 0, 1, 2 or 3 blocks (with or without tail) starting at
    // Loop5x_enc_after
 cmn	x2,#0x10
 b.ne	Loop5x_enc_after
    b.eq  Lxts_enc_tail4x

Loop5x_enc_after:
 add	x2,x2,#0x50
 cbz	x2,Lxts_enc_done     // no blocks left

 add	w6,w5,#2
 subs	x2,x2,#0x30
 b.lo	Lxts_inner_enc_tail    // 1 or 2 blocks left
                                    // (with tail or not)

 eor	v0.16b,v6.16b,v27.16b         // 3 blocks left
 eor	v1.16b,v8.16b,v28.16b
 eor	v24.16b,v29.16b,v9.16b
 b	Lxts_outer_enc_tail

.align	4
Lxts_enc_tail4x:
 orr	v11.16b,v10.16b,v10.16b
 orr	v10.16b,v9.16b,v9.16b
 orr	v9.16b,v8.16b,v8.16b
 orr	v8.16b,v6.16b,v6.16b
 fmov	x9,d11
 fmov	x10,v11.d[1]
 eor	v1.16b,v8.16b,v3.16b
 eor	v24.16b,v27.16b,v9.16b
 eor	v25.16b,v28.16b,v10.16b
 eor	v26.16b,v29.16b,v11.16b

 aesr    v1.16b, v16.16b
 aesr    v24.16b, v16.16b
 aesr    v25.16b, v16.16b
 aesr    v26.16b, v16.16b
 subs	x2,x2,#0x50         // because Lxts_enc_tail4x

 aesr    v1.16b, v17.16b
 aesr    v24.16b, v17.16b
 aesr    v25.16b, v17.16b
 aesr    v26.16b, v17.16b
 csel	x6,xzr,x2,gt    // borrow x6, w6, "gt" is not typo

 aesr    v1.16b, v12.16b
 aesr    v24.16b, v12.16b
 aesr    v25.16b, v12.16b
 aesr    v26.16b, v12.16b

 aesr    v1.16b, v13.16b
 aesr    v24.16b, v13.16b
 aesr    v25.16b, v13.16b
 aesr    v26.16b, v13.16b

 aesr    v1.16b, v14.16b
 aesr    v24.16b, v14.16b
 aesr    v25.16b, v14.16b
 aesr    v26.16b, v14.16b

 aesr    v1.16b, v15.16b
 aesr    v24.16b, v15.16b
 aesr    v25.16b, v15.16b
 aesr    v26.16b, v15.16b

 aesr    v1.16b, v4.16b
 aesr    v24.16b, v4.16b
 aesr    v25.16b, v4.16b
 aesr    v26.16b, v4.16b

 aesr    v1.16b, v5.16b
 aesr    v24.16b, v5.16b
 aesr    v25.16b, v5.16b
 aesr    v26.16b, v5.16b

 aesr    v1.16b, v18.16b
 aesr    v24.16b, v18.16b
 aesr    v25.16b, v18.16b
 aesr    v26.16b, v18.16b
 add	x0,x0,x6  // x0 is adjusted in such way that
                                // at exit from the loop v1.16b-v26.16b
                                // are loaded with last "words"

 aesr    v1.16b, v19.16b
 aesr    v24.16b, v19.16b
 aesr    v25.16b, v19.16b
 aesr    v26.16b, v19.16b

 aesr    v1.16b, v20.16b
 aesr    v24.16b, v20.16b
 aesr    v25.16b, v20.16b
 aesr    v26.16b, v20.16b

 aesr    v1.16b, v21.16b
 aesr    v24.16b, v21.16b
 aesr    v25.16b, v21.16b
 aesr    v26.16b, v21.16b

 aesr    v1.16b, v22.16b
 aesr    v24.16b, v22.16b
 aesr    v25.16b, v22.16b
 aesr    v26.16b, v22.16b

 aese	v1.16b,v23.16b
 aese	v24.16b,v23.16b
 aese	v25.16b,v23.16b
 aese	v26.16b,v23.16b

    // The iv for first block of one iteration
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d6,x9
 fmov	v6.d[1],x10
    eor	v1.16b,v1.16b,v7.16b
    eor	v1.16b,v1.16b,v8.16b
 ld1	{v2.16b},[x0],#16
    // The iv for second block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d8,x9
 fmov	v8.d[1],x10
    eor	v24.16b,v24.16b,v7.16b
    eor	v24.16b,v24.16b,v9.16b
    ld1	{v3.16b},[x0],#16
    // The iv for third block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d9,x9
 fmov	v9.d[1],x10
    eor	v25.16b,v25.16b,v7.16b
    eor	v25.16b,v25.16b,v10.16b
 ld1	{v27.16b},[x0],#16
    // The iv for fourth block
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d10,x9
 fmov	v10.d[1],x10
    eor	v26.16b,v26.16b,v7.16b
    eor	v26.16b,v26.16b,v11.16b
 ld1	{v28.16b},[x0],#16
 ld1	{v29.16b},[x0],#16

 add	x0,x0,#16
    st1  {v1.16b},[x1],#16
    st1	{v24.16b,v25.16b},[x1],#32
    st1  {v26.16b},[x1],#16
 b	Lxts_enc_done
.align	4
Lxts_outer_enc_tail:
  // First round with v16
  aesr    v0.16b, v16.16b
  aesr    v1.16b, v16.16b
  aesr    v24.16b, v16.16b

  // Second round with v17
  aesr    v0.16b, v17.16b
  aesr    v1.16b, v17.16b
  aesr    v24.16b, v17.16b

  // Third round with v12
  aesr    v0.16b, v12.16b
  aesr    v1.16b, v12.16b
  aesr    v24.16b, v12.16b

  // Fourth round with v13
  aesr    v0.16b, v13.16b
  aesr    v1.16b, v13.16b
  aesr    v24.16b, v13.16b

  // Fifth round with v14
  aesr    v0.16b, v14.16b
  aesr    v1.16b, v14.16b
  aesr    v24.16b, v14.16b

  // Sixth round with v15
  aesr    v0.16b, v15.16b
  aesr    v1.16b, v15.16b
  aesr    v24.16b, v15.16b

  // Seventh round with v4
  aesr    v0.16b, v4.16b
  aesr    v1.16b, v4.16b
  aesr    v24.16b, v4.16b

  // Eighth round with v5
  aesr    v0.16b, v5.16b
  aesr    v1.16b, v5.16b
  aesr    v24.16b, v5.16b

  // 9th round with v18
  aesr    v0.16b, v18.16b
  aesr    v1.16b, v18.16b
  aesr    v24.16b, v18.16b

  // 10th round with v19
  aesr    v0.16b, v19.16b
  aesr    v1.16b, v19.16b
  aesr    v24.16b, v19.16b


 aesr    v0.16b, v20.16b
 aesr    v1.16b, v20.16b
 aesr    v24.16b, v20.16b
 aesr    v0.16b, v21.16b
 aesr    v1.16b, v21.16b
 aesr    v24.16b, v21.16b
 aesr    v0.16b, v22.16b
 aesr    v1.16b, v22.16b
 aesr    v24.16b, v22.16b
 aese	v0.16b,v23.16b
 aese	v1.16b,v23.16b
 aese	v24.16b,v23.16b

 eor	v30.16b,v6.16b,v7.16b
 eor	v11.16b,v9.16b,v7.16b
 subs	x2,x2,#0x30
    // The iv for first block
 fmov	x9,d9
 fmov	x10,v9.d[1]
    // mov   w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr#31
 eor	x9,x11,x9,lsl#1
 fmov	d6,x9
 fmov	v6.d[1],x10
 eor	v10.16b,v8.16b,v7.16b
 csel	x6,x2,x6,lo   // x6, w6, is zero at this point

 add	x6,x6,#0x20
 add	x0,x0,x6
 mov	x7,x3

 ld1	{v27.16b},[x0],#16
 add	w6,w5,#2
 eor	v30.16b,v30.16b,v0.16b
 eor	v31.16b,v10.16b,v1.16b
 eor	v24.16b,v24.16b,v11.16b
 ld1	{v16.4s,v17.4s},[x7],#32
 st1	{v30.16b,v31.16b},[x1],#32
 st1	{v24.16b},[x1],#16
 cmn	x2,#0x30
 b.eq	Lxts_enc_done
Lxts_encxor_one:
 orr	v28.16b,v3.16b,v3.16b
 orr	v29.16b,v27.16b,v27.16b
 nop

Lxts_inner_enc_tail:
 cmn	x2,#0x10
 eor	v1.16b,v28.16b,v6.16b
 eor	v24.16b,v29.16b,v8.16b
 b.eq	Lxts_enc_tail_loop
 eor	v24.16b,v29.16b,v6.16b
Lxts_enc_tail_loop:
  // First round with v16
  aesr    v1.16b, v16.16b
  aesr    v24.16b, v16.16b

  // Second round with v17
  aesr    v1.16b, v17.16b
  aesr    v24.16b, v17.16b

  // Third round with v12
  aesr    v1.16b, v12.16b
  aesr    v24.16b, v12.16b

  // Fourth round with v13
  aesr    v1.16b, v13.16b
  aesr    v24.16b, v13.16b

  // Fifth round with v14
  aesr    v1.16b, v14.16b
  aesr    v24.16b, v14.16b

  // Sixth round with v15
  aesr    v1.16b, v15.16b
  aesr    v24.16b, v15.16b

  // Seventh round with v4
  aesr    v1.16b, v4.16b
  aesr    v24.16b, v4.16b

  // Eighth round with v5
  aesr    v1.16b, v5.16b
  aesr    v24.16b, v5.16b

  // 9th round with v18
  aesr    v1.16b, v18.16b
  aesr    v24.16b, v18.16b

  // 10th round with v19
  aesr    v1.16b, v19.16b
  aesr    v24.16b, v19.16b

 aesr    v1.16b, v20.16b
 aesr    v24.16b, v20.16b
 cmn	x2,#0x20
 aesr    v1.16b, v21.16b
 aesr    v24.16b, v21.16b
 eor	v5.16b,v6.16b,v7.16b
 aesr    v1.16b, v22.16b
 aesr    v24.16b, v22.16b
 eor	v17.16b,v8.16b,v7.16b
 aese	v1.16b,v23.16b
 aese	v24.16b,v23.16b
 b.eq	Lxts_enc_one
 eor	v5.16b,v5.16b,v1.16b
 st1	{v5.16b},[x1],#16
 eor	v17.16b,v17.16b,v24.16b
 orr	v6.16b,v8.16b,v8.16b
 st1	{v17.16b},[x1],#16
 fmov	x9,d8
 fmov	x10,v8.d[1]
 mov	w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr #31
 eor	x9,x11,x9,lsl #1
 fmov	d6,x9
 fmov	v6.d[1],x10
 b	Lxts_enc_done

Lxts_enc_one:
 eor	v5.16b,v5.16b,v24.16b
 orr	v6.16b,v6.16b,v6.16b
 st1	{v5.16b},[x1],#16
 fmov	x9,d6
 fmov	x10,v6.d[1]
 mov	w19,#0x87
 extr	x22,x10,x10,#32
 extr	x10,x10,x9,#63
 and	w11,w19,w22,asr #31
 eor	x9,x11,x9,lsl #1
 fmov	d6,x9
 fmov	v6.d[1],x10
 b	Lxts_enc_done
.align	5
Lxts_enc_done:
    // Process the tail block with cipher stealing.
 tst	x21,#0xf
 b.eq	Lxts_abort

 mov	x20,x0
 mov	x13,x1
 sub	x1,x1,#16
.composite_enc_loop:
 subs	x21,x21,#1
 ldrb	w15,[x1,x21]
 ldrb	w14,[x20,x21]
 strb	w15,[x13,x21]
 strb	w14,[x1,x21]
 b.gt	.composite_enc_loop
Lxts_enc_load_done:
 ld1	{v26.16b},[x1]
 eor	v26.16b,v26.16b,v6.16b

    // Encrypt the composite block to get the last second encrypted text block
 ldr	w6,[x3,#240]        // load key schedule...
 ld1	{v0.16b},[x3],#16
 sub	w6,w6,#2
 ld1	{v1.16b},[x3],#16     // load key schedule...
Loop_final_enc:
 aesr    v26.16b, v0.16b
 ld1	{v0.4s},[x3],#16
 subs	w6,w6,#2
 aesr    v26.16b, v1.16b
 ld1	{v1.4s},[x3],#16
 b.gt	Loop_final_enc

 aesr    v26.16b, v0.16b
 ld1	{v0.4s},[x3]
 aese	v26.16b,v1.16b
 eor	v26.16b,v26.16b,v0.16b
 eor	v26.16b,v26.16b,v6.16b
 st1	{v26.16b},[x1]

Lxts_abort:
 ldp	x21,x22,[sp,#16]
 ldp	x19,x20,[sp],#32
Lxts_enc_final_abort:
    restore_vregs
    add sp, sp, #STACK_SIZE_VREGS
 ret

#endif
#endif  // !OPENSSL_NO_ASM && defined(__AARCH64EL__) && defined(__APPLE__)
#if defined(__ELF__)
// See https: // www.airs.com/blog/archives/518.
.section .note.GNU-stack,"",%progbits
#endif
